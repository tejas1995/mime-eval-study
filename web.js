(()=>{"use strict";let o="https://tejassrinivasan.pythonanywhere.com/";var t=[];let n=-1,i=null,a=-1,e=!1,l=0,s=0;function r(o){l+=o,0==l?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),0==l?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),1==l&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),_()),$("#main_box_instructions").children(":not(input)").each(((o,t)=>{$(t).hide()})),$(`#instructions_${l}`).show()}$("#button_instructions_next").on("click",(()=>r(1))),$("#button_instructions_prev").on("click",(()=>r(-1)));const u=document.getElementById("mime_video");function c(o){a=o;for(let o=1;o<=4;o++)$(`#button_option${o}`).attr("disabled","true");$(`#button_option${o}`).attr("activedecision","true"),e=a==i.label_idx+1,$("#button_next").show()}u?u.addEventListener("ended",(()=>{console.log("The user has watched the full video."),$("#watchvideo_instruction").hide(),$("#answer_box").show()})):console.error('Video element with ID "mime_video" not found.'),$("#answer_box").on("keyup",(()=>{""!=String($("#user_prediction").val()).trim()?$("#button_submit").show():(console.log("The text box is empty."),$("#button_submit").hide())})),$("#button_submit").on("click",(()=>{$("#button_submit").hide(),$("#mcq_box").show(),$("#user_prediction").attr("disabled","true")})),$("#button_option1").on("click",(()=>c(1))),$("#button_option2").on("click",(()=>c(2))),$("#button_option3").on("click",(()=>c(3))),$("#button_option4").on("click",(()=>c(4))),$("#button_next").on("click",(()=>{if(-1!=n){let t={question_i:n,sample_id:i.sample_id,user_answer:$("#user_prediction").val(),user_mcq_selection:a,user_is_correct:e};t.question=i,t.count_exited_page=s,async function(t){t.url_data=globalThis.url_data,console.log("Data"),"study_id"in t.url_data||(t.url_data.study_id="demo_study"),"prolific_id"in t.url_data||(t.url_data.prolific_id="demo_user"),"session_id"in t.url_data||(t.url_data.session_id="demo_session"),t.url_data.queue_id=globalThis.uid,console.log("logged",t),console.log("Logging to",o+"log");try{let n=await $.ajax(o+"log",{data:JSON.stringify({project:"mime-eval-study/human-eval/",uid:globalThis.uid+"_"+globalThis.annotator,payload:JSON.stringify(t)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((o=>setTimeout(o,2e3)))}(),n}catch(o){console.log(o)}}(t),s=0}_()}));let d=null;function _(){if(d&&(clearInterval(d),d=null),n+=1,n>=t.length)return $("#main_box_experiment").hide(),$("#reward_box").show(),void $("#main_box_end").show();i=t[n],console.log(i);let o=document.getElementById("mime_video");o&&o.setAttribute("src",i.s3_url),console.log(i.sample_id),console.log(i.s3_url),$("#user_prediction").val(""),$("#option1_span").html(i.options[0]),$("#option2_span").html(i.options[1]),$("#option3_span").html(i.options[2]),$("#option4_span").html(i.options[3]),$("#mime_video").show(),$("#watchvideo_instruction").show(),$("#answer_box").hide(),$("#mcq_box").hide(),$("#button_next").hide(),$("#button_submit").hide(),$("#button_quit").hide(),$("#progress").text(`Progress: ${n+1} / ${t.length}`)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==d&&(clearInterval(d),d=null)):console.log("Window regained focus.")};const g=new URLSearchParams(window.location.search),b=g.get("start");g.get("uid"),globalThis.url_data=function(o){const t={};for(const[n,i]of o)t[n]=i;return t}(g.entries()),globalThis.avatar=g.get("avatar"),null==globalThis.avatar&&(globalThis.avatar="man"),globalThis.angle=g.get("angle"),null==globalThis.angle&&(globalThis.angle="0"),globalThis.background=g.get("background"),null==globalThis.background&&(globalThis.background="blank"),globalThis.annotator=g.get("annotator"),null==globalThis.annotator&&(globalThis.annotator="none"),globalThis.set=g.get("set"),null==globalThis.set&&(globalThis.set="1"),globalThis.uid=`${globalThis.avatar}_avatar-${globalThis.angle}_angle-${globalThis.background}_background-set${globalThis.set}`,console.log("Running with annotator",globalThis.annotator),console.log("Running with avatar",globalThis.avatar),console.log("Running with angle",globalThis.angle),console.log("Running with background",globalThis.background),async function(){return await $.getJSON(`baked_queues/${globalThis.avatar}_avatar-${globalThis.angle}_angle-${globalThis.background}_background-set${globalThis.set}.json?t=${Date.now()}`)}().catch((o=>{console.log("Invalid params: ",globalThis.url_data),window.location.reload()})).then((o=>{t=o,null!=b&&(n=parseInt(b)-1,console.log("Starting from",n)),r(0),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with annotator:",globalThis.annotator)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QyxpQkFBaUJ0QyxXQUFXdUMsZUFBZXZDLFdBQVd3Qyw0QkFBNEJ4QyxXQUFXeUMsTUFtQjVIaEQsUUFBUUMsSUFBSSx5QkFBMEJNLFdBQVdRLFdBQ2pEZixRQUFRQyxJQUFJLHNCQUF1Qk0sV0FBV3NDLFFBQzlDN0MsUUFBUUMsSUFBSSxxQkFBc0JNLFdBQVd1QyxPQUM3QzlDLFFBQVFDLElBQUksMEJBQTJCTSxXQUFXd0MsWURoUzNDekMsaUJBS0gsYUFIbUJ6QixFQUFFb0UsUUFDakIsZ0JBQWdCMUMsV0FBV3NDLGlCQUFpQnRDLFdBQVd1QyxlQUFldkMsV0FBV3dDLDRCQUE0QnhDLFdBQVd5QyxjQUFjRSxLQUFLQyxRQUduSixDQzRSQUMsR0FBWUMsT0FBT0MsSUFFZnRELFFBQVFDLElBQUksbUJBQW9CTSxXQUFXQyxVQUMzQzRCLE9BQU9DLFNBQVNrQixRQUFRLElBRTFCQyxNQUFNQyxJQUNKckYsRUFBT3FGLEVBQ2MsTUFBakJsQixJQUNBbEUsRUFBYXFGLFNBQVNuQixHQUFpQixFQUN2Q3ZDLFFBQVFDLElBQUksZ0JBQWlCNUIsSUFHakNNLEVBQWtCLEdBQ2xCRSxFQUFFLDBCQUEwQkcsT0FDNUJILEVBQUUsaUNBQWlDSyxNQUFNLElBNEI3Q2MsUUFBUUMsSUFBSSxtQ0FBb0NNLFdBQVdRLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29ubmVjdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIiwid2VicGFjazovLy8uL3NyYy91dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBERVZNT0RFIH0gZnJvbSAnLi9nbG9iYWxzJ1xuaW1wb3J0IHsgTU9DS01PREUgfSBmcm9tICcuL21haW4nXG5cbmxldCBTRVJWRVJfTE9HX1JPT1QgPSBERVZNT0RFID8gXCJodHRwOi8vMTI3LjAuMC4xOjUwMDAvXCIgOiBcImh0dHBzOi8vdGVqYXNzcmluaXZhc2FuLnB5dGhvbmFueXdoZXJlLmNvbS9cIlxuXG5hc3luYyBmdW5jdGlvbiBzbGVlcChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkX2RhdGEoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBpbmNsdWRlIHRpbWVzdGFtcCBzbyB0aGF0IHRoaW5ncyBkb24ndCBnZXQgY2FjaGVkXG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0ICQuZ2V0SlNPTihcbiAgICAgICAgYGJha2VkX3F1ZXVlcy8ke2dsb2JhbFRoaXMuYXZhdGFyfV9hdmF0YXItJHtnbG9iYWxUaGlzLmFuZ2xlfV9hbmdsZS0ke2dsb2JhbFRoaXMuYmFja2dyb3VuZH1fYmFja2dyb3VuZC1zZXQke2dsb2JhbFRoaXMuc2V0fS5qc29uP3Q9JHtEYXRlLm5vdygpfWAsXG4gICAgKVxuICAgIHJldHVybiByZXN1bHRcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dfZGF0YShkYXRhKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvL2lmIChNT0NLTU9ERSkge1xuICAgIC8vICAgIGNvbnNvbGUubG9nKFwibG9nZ2VkIChtb2NrKVwiLCBkYXRhKVxuICAgIC8vICAgIHJldHVyblxuICAgIC8vfVxuICAgIFxuICAgIGRhdGFbXCJ1cmxfZGF0YVwiXSA9IGdsb2JhbFRoaXMudXJsX2RhdGFcbiAgICBjb25zb2xlLmxvZyhcIkRhdGFcIilcbiAgICBpZiAoIShcInN0dWR5X2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInN0dWR5X2lkXCJdID0gXCJkZW1vX3N0dWR5XCJcbiAgICB9XG4gICAgaWYgKCEoXCJwcm9saWZpY19pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJwcm9saWZpY19pZFwiXSA9IFwiZGVtb191c2VyXCJcbiAgICB9XG4gICAgaWYgKCEoXCJzZXNzaW9uX2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInNlc3Npb25faWRcIl0gPSBcImRlbW9fc2Vzc2lvblwiXG4gICAgfVxuICAgIGRhdGFbXCJ1cmxfZGF0YVwiXVtcInF1ZXVlX2lkXCJdID0gZ2xvYmFsVGhpcy51aWRcbiAgICBjb25zb2xlLmxvZyhcImxvZ2dlZFwiLCBkYXRhKVxuICAgIGNvbnNvbGUubG9nKFwiTG9nZ2luZyB0b1wiLCBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0ICQuYWpheChcbiAgICAgICAgICAgIFNFUlZFUl9MT0dfUk9PVCArIFwibG9nXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBcIm1pbWUtZXZhbC1zdHVkeS9odW1hbi1ldmFsL1wiLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6IGdsb2JhbFRoaXMudWlkICsgXCJfXCIgKyBnbG9iYWxUaGlzLmFubm90YXRvcixcbiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgYXdhaXQgc2xlZXAoMjAwMCk7XG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpXG4gICAgfVxufSIsImltcG9ydCB7IERFVk1PREUsIFJFV0FSRF9DT1JSRUNULCBQRU5BTFRZX0lOQ09SUkVDVCwgRU5BQkxFX1RJTUVSIH0gZnJvbSBcIi4vZ2xvYmFsc1wiXG5leHBvcnQgdmFyIFVJRDogc3RyaW5nXG5leHBvcnQgdmFyIE1PQ0tNT0RFOiBib29sZWFuID0gZmFsc2VcbmltcG9ydCB7IGxvYWRfZGF0YSwgbG9nX2RhdGEgfSBmcm9tICcuL2Nvbm5lY3RvcidcbmltcG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0gZnJvbSBcIi4vdXRpbHNcIlxuXG52YXIgZGF0YTogYW55W10gPSBbXVxubGV0IHF1ZXN0aW9uX2kgPSAtMVxubGV0IHF1ZXN0aW9uOiBhbnkgPSBudWxsXG5cblxubGV0IGJhbGFuY2UgPSAwXG5cbmxldCB1c2VyX21jcV9zZWxlY3Rpb24gPSAtMVxubGV0IHVzZXJfaXNfY29ycmVjdCA9IGZhbHNlXG5cbmxldCBpbnN0cnVjdGlvbl9pOiBudW1iZXIgPSAwXG5sZXQgY291bnRfZXhpdGVkX3BhZ2U6IG51bWJlciA9IDBcblxuZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkge1xuICAgIGlmICghY29uZGl0aW9uKSB7XG4gICAgICAgIHRocm93IG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCI7XG4gICAgfVxufVxuXG5cbmZ1bmN0aW9uIG5leHRfaW5zdHJ1Y3Rpb25zKGluY3JlbWVudDogbnVtYmVyKSB7XG4gICAgaW5zdHJ1Y3Rpb25faSArPSBpbmNyZW1lbnRcblxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgIH1cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSAwKSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5zaG93KClcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikudmFsKFwiU3RhcnQgc3R1ZHlcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIk5leHRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gMSkge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuc2hvdygpXG4gICAgICAgIG5leHRfcXVlc3Rpb24oKVxuICAgIH1cblxuICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmNoaWxkcmVuKFwiOm5vdChpbnB1dClcIikuZWFjaCgoXywgZWwpID0+IHtcbiAgICAgICAgJChlbCkuaGlkZSgpXG4gICAgfSlcbiAgICAkKGAjaW5zdHJ1Y3Rpb25zXyR7aW5zdHJ1Y3Rpb25faX1gKS5zaG93KClcbn1cbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoKzEpKVxuJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikub24oXCJjbGlja1wiLCAoKSA9PiBuZXh0X2luc3RydWN0aW9ucygtMSkpXG5cbi8vIEFkZCBsaXN0ZW5lciB0byBlbnN1cmUgdGhlIHZpZGVvIGhhcyBiZWVuIHdhdGNoZWRcbmNvbnN0IHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW1lX3ZpZGVvJyk7XG5cbmlmICh2aWRlb0VsZW1lbnQpIHtcbiAgICAvLyBBZGQgYW4gZXZlbnQgbGlzdGVuZXIgZm9yIHRoZSAnZW5kZWQnIGV2ZW50XG4gICAgdmlkZW9FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnVGhlIHVzZXIgaGFzIHdhdGNoZWQgdGhlIGZ1bGwgdmlkZW8uJyk7XG4gICAgICAgIC8vIFlvdSBjYW4gYWRkIGFkZGl0aW9uYWwgYWN0aW9ucyBoZXJlLCBzdWNoIGFzIG1hcmtpbmcgdGhlIHZpZGVvIGFzIHdhdGNoZWRcbiAgICAgICAgJChcIiN3YXRjaHZpZGVvX2luc3RydWN0aW9uXCIpLmhpZGUoKVxuICAgICAgICAvLyQoXCIjdXNlcl9wcmVkaWN0aW9uXCIpLnZhbChcIlwiKVxuICAgICAgICAkKFwiI2Fuc3dlcl9ib3hcIikuc2hvdygpXG4gICAgfSk7XG59IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZpZGVvIGVsZW1lbnQgd2l0aCBJRCBcIm1pbWVfdmlkZW9cIiBub3QgZm91bmQuJyk7XG59XG5cblxuJCgnI2Fuc3dlcl9ib3gnKS5vbigna2V5dXAnLCAoKSA9PiB7XG4gICAgbGV0IHVzZXJfcHJlZGljdGlvbiA9IFN0cmluZygkKCcjdXNlcl9wcmVkaWN0aW9uJykudmFsKCkpLnRyaW0oKVxuICAgIGlmICh1c2VyX3ByZWRpY3Rpb24gIT0gJycpIHtcbiAgICAgICAgJChcIiNidXR0b25fc3VibWl0XCIpLnNob3coKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGUgdGV4dCBib3ggaXMgZW1wdHkuJyk7XG4gICAgICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5oaWRlKClcbiAgICB9XG59KTtcblxuJChcIiNidXR0b25fc3VibWl0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5oaWRlKClcbiAgICAkKFwiI21jcV9ib3hcIikuc2hvdygpXG4gICAgLy8gRGlzYWJsZSB0aGUgdGV4dCBib3hcbiAgICAkKFwiI3VzZXJfcHJlZGljdGlvblwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG59KTtcblxuZnVuY3Rpb24gcmVnaXN0ZXJfbWNxX3NlbGVjdGlvbihvcHRpb24pIHtcbiAgICB1c2VyX21jcV9zZWxlY3Rpb24gPSBvcHRpb25cbiAgICBmb3IgKGxldCBpID0gMTsgaSA8PSA0OyBpKyspIHtcbiAgICAgICAgJChgI2J1dHRvbl9vcHRpb24ke2l9YCkuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIH1cbiAgICAkKGAjYnV0dG9uX29wdGlvbiR7b3B0aW9ufWApLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB1c2VyX2lzX2NvcnJlY3QgPSAodXNlcl9tY3Ffc2VsZWN0aW9uID09IHF1ZXN0aW9uWydsYWJlbF9pZHgnXSsxKSA/IHRydWUgOiBmYWxzZVxuXG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5zaG93KClcbn1cbiQoXCIjYnV0dG9uX29wdGlvbjFcIikub24oXCJjbGlja1wiLCAoKSA9PiByZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uKDEpKVxuJChcIiNidXR0b25fb3B0aW9uMlwiKS5vbihcImNsaWNrXCIsICgpID0+IHJlZ2lzdGVyX21jcV9zZWxlY3Rpb24oMikpXG4kKFwiI2J1dHRvbl9vcHRpb24zXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gcmVnaXN0ZXJfbWNxX3NlbGVjdGlvbigzKSlcbiQoXCIjYnV0dG9uX29wdGlvbjRcIikub24oXCJjbGlja1wiLCAoKSA9PiByZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uKDQpKVxuXG5cbiQoXCIjYnV0dG9uX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHVzZXIgYmFsYW5jZVxuICAgIGlmIChxdWVzdGlvbl9pICE9IC0xKSB7XG4gICAgICAgIGxldCBsb2dnZWRfZGF0YSA9IHtcbiAgICAgICAgICAgIFwicXVlc3Rpb25faVwiOiBxdWVzdGlvbl9pLFxuICAgICAgICAgICAgXCJzYW1wbGVfaWRcIjogcXVlc3Rpb25bJ3NhbXBsZV9pZCddLFxuICAgICAgICAgICAgXCJ1c2VyX2Fuc3dlclwiOiAkKFwiI3VzZXJfcHJlZGljdGlvblwiKS52YWwoKSxcbiAgICAgICAgICAgIFwidXNlcl9tY3Ffc2VsZWN0aW9uXCI6IHVzZXJfbWNxX3NlbGVjdGlvbixcbiAgICAgICAgICAgIFwidXNlcl9pc19jb3JyZWN0XCI6IHVzZXJfaXNfY29ycmVjdCxcbiAgICAgICAgfVxuICAgICAgICBsb2dnZWRfZGF0YVsncXVlc3Rpb24nXSA9IHF1ZXN0aW9uXG4gICAgICAgIGxvZ2dlZF9kYXRhWydjb3VudF9leGl0ZWRfcGFnZSddID0gY291bnRfZXhpdGVkX3BhZ2VcbiAgICAgICAgbG9nX2RhdGEobG9nZ2VkX2RhdGEpXG4gICAgICAgIGNvdW50X2V4aXRlZF9wYWdlID0gMFxuICAgIH1cbiAgICBcblxuICAgIG5leHRfcXVlc3Rpb24oKVxufSk7XG5cblxubGV0IGFjdGl2ZVRpbWVyOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRJbnRlcnZhbD4gfCBudWxsID0gbnVsbDsgLy8gVGltZXIgaW50ZXJ2YWxcblxuZnVuY3Rpb24gc3RhcnRUaW1lcihkdXJhdGlvbiwgc3RlcERpdiwgYnV0dG9ucywgY2FsbGJhY2spIHtcbiAgICBpZiAoIUVOQUJMRV9USU1FUikge1xuICAgICAgICAvLyBJZiB0aGUgdGltZXIgaXMgZGlzYWJsZWQsIGVuYWJsZSB0aGUgYnV0dG9ucyBpbW1lZGlhdGVseVxuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSk7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGFueSBleGlzdGluZyB0aW1lciB0byBwcmV2ZW50IG11bHRpcGxlIGludGVydmFsc1xuICAgIGlmIChhY3RpdmVUaW1lcikge1xuICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTtcbiAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIERpc2FibGUgYnV0dG9uc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKSk7XG4gICAgXG4gICAgLy8gU2hvdyB0aW1lciB2aXN1YWxseVxuICAgIGxldCB0aW1lckRpc3BsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aW1lckRpc3BsYXkuaWQgPSBgdGltZXJfJHtzdGVwRGl2LmlkfWA7XG4gICAgdGltZXJEaXNwbGF5LnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7XG4gICAgdGltZXJEaXNwbGF5LnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JztcbiAgICBzdGVwRGl2LmFwcGVuZENoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICBsZXQgcmVtYWluaW5nVGltZSA9IGR1cmF0aW9uO1xuXG4gICAgLy8gSW5pdGlhbCBkaXNwbGF5XG4gICAgdGltZXJEaXNwbGF5LnRleHRDb250ZW50ID0gYFBsZWFzZSB3YWl0ICR7cmVtYWluaW5nVGltZX0gc2Vjb25kKHMpIGJlZm9yZSBtYWtpbmcgeW91ciBzZWxlY3Rpb24uYDtcblxuICAgIGFjdGl2ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICByZW1haW5pbmdUaW1lLS07XG4gICAgICAgIGlmIChyZW1haW5pbmdUaW1lID49IDApIHtcbiAgICAgICAgICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpOyAvLyBTdG9wIHRoZSB0aW1lclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRpbWVyIGRpc3BsYXlcbiAgICAgICAgICAgIHN0ZXBEaXYucmVtb3ZlQ2hpbGQodGltZXJEaXNwbGF5KTtcblxuICAgICAgICAgICAgLy8gRW5hYmxlIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpKTtcblxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfSwgMTAwMCk7XG59XG5cbi8vIFdoZW4gdGhlIHVzZXIgc3dpdGNoZXMgdGFicyBvciBtaW5pbWl6ZXMgdGhlIHdpbmRvdywgcGF1c2UgdGhlIHRpbWVyXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50LmhpZGRlbikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyBsb3N0IGZvY3VzLlwiKTtcbiAgICAgICAgaWYgKGFjdGl2ZVRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gUGF1c2UgdGhlIHRpbWVyXG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBIYW5kbGUgbG9naWMgd2hlbiB0aGUgdXNlciByZXR1cm5zXG4gICAgICAgIGNvbnNvbGUubG9nKFwiV2luZG93IHJlZ2FpbmVkIGZvY3VzLlwiKTtcbiAgICB9XG59O1xuXG5cblxuZnVuY3Rpb24gbmV4dF9xdWVzdGlvbigpIHtcbiAgICAvLyBSZXNldCB0aW1lcnMgYW5kIHN0YXRlXG4gICAgaWYgKGFjdGl2ZVRpbWVyKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpO1xuICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gcmVzdG9yZSBwcmV2aW91cyBzdGF0ZSBvZiBVSVxuXG4gICAgLy8kKFwiI3JhbmdlX3ZhbFwiKS52YWwodXNlcl90cnVzdClcblxuICAgIHF1ZXN0aW9uX2kgKz0gMVxuICAgIGlmIChxdWVzdGlvbl9pID49IGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICQoXCIjbWFpbl9ib3hfZXhwZXJpbWVudFwiKS5oaWRlKClcbiAgICAgICAgJCgnI3Jld2FyZF9ib3gnKS5zaG93KClcbiAgICAgICAgJChcIiNtYWluX2JveF9lbmRcIikuc2hvdygpXG4gICAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHF1ZXN0aW9uID0gZGF0YVtxdWVzdGlvbl9pXVxuICAgIGNvbnNvbGUubG9nKHF1ZXN0aW9uKVxuXG4gICAgbGV0IHZpZGVvT2JqZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaW1lX3ZpZGVvXCIpXG4gICAgaWYgKHZpZGVvT2JqZWN0KSB7XG4gICAgICAgIHZpZGVvT2JqZWN0LnNldEF0dHJpYnV0ZShcInNyY1wiLCBxdWVzdGlvblsnczNfdXJsJ10pXG4gICAgfVxuICAgIGNvbnNvbGUubG9nKHF1ZXN0aW9uWydzYW1wbGVfaWQnXSlcbiAgICBjb25zb2xlLmxvZyhxdWVzdGlvblsnczNfdXJsJ10pXG4gICAgJChcIiN1c2VyX3ByZWRpY3Rpb25cIikudmFsKFwiXCIpXG4gICAgJChcIiNvcHRpb24xX3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJvcHRpb25zXCJdWzBdKVxuICAgICQoXCIjb3B0aW9uMl9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wib3B0aW9uc1wiXVsxXSlcbiAgICAkKFwiI29wdGlvbjNfc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcIm9wdGlvbnNcIl1bMl0pXG4gICAgJChcIiNvcHRpb240X3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJvcHRpb25zXCJdWzNdKVxuXG4gICAgJChcIiNtaW1lX3ZpZGVvXCIpLnNob3coKVxuICAgICQoXCIjd2F0Y2h2aWRlb19pbnN0cnVjdGlvblwiKS5zaG93KClcbiAgICAkKCcjYW5zd2VyX2JveCcpLmhpZGUoKVxuICAgICQoXCIjbWNxX2JveFwiKS5oaWRlKClcbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLmhpZGUoKVxuICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5oaWRlKClcbiAgICAkKCcjYnV0dG9uX3F1aXQnKS5oaWRlKClcblxuXG4gICAgLy8gc2V0IGJldCB2YWx1ZSByYXRpb1xuICAgIC8vaWYocXVlc3Rpb24uaGFzT3duUHJvcGVydHkoXCJyZXdhcmRfcmF0aW9cIikpIHtcbiAgICAvLyAgICBsZXQgW3JhdGlvMSwgcmF0aW8yXSA9IHF1ZXN0aW9uW1wicmV3YXJkX3JhdGlvXCJdXG4gICAgLy8gICAgcmF0aW8xID0gTnVtYmVyKHJhdGlvMSlcbiAgICAvLyAgICByYXRpbzIgPSBOdW1iZXIocmF0aW8yKVxuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSByYXRpbzEvcmF0aW8yXG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSAxXG4gICAgLy99XG5cbiAgICAvL3RpbWVfcXVlc3Rpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgJChcIiNwcm9ncmVzc1wiKS50ZXh0KGBQcm9ncmVzczogJHtxdWVzdGlvbl9pICsgMX0gLyAke2RhdGEubGVuZ3RofWApXG5cbn1cblxuXG5cbi8vIGdldCB1c2VyIGlkIGFuZCBsb2FkIHF1ZXVlXG4vLyB0cnkgdG8gc2VlIGlmIHN0YXJ0IG92ZXJyaWRlIHdhcyBwYXNzZWRcbmNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG5jb25zdCBzdGFydE92ZXJyaWRlID0gdXJsUGFyYW1zLmdldCgnc3RhcnQnKTtcbmNvbnN0IFVJREZyb21VUkwgPSB1cmxQYXJhbXMuZ2V0KFwidWlkXCIpXG5nbG9iYWxUaGlzLnVybF9kYXRhID0gcGFyYW1zVG9PYmplY3QodXJsUGFyYW1zLmVudHJpZXMoKSlcblxuZ2xvYmFsVGhpcy5hdmF0YXIgPSB1cmxQYXJhbXMuZ2V0KFwiYXZhdGFyXCIpXG5pZiAoZ2xvYmFsVGhpcy5hdmF0YXIgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmF2YXRhciA9IFwibWFuXCIgfVxuZ2xvYmFsVGhpcy5hbmdsZSA9IHVybFBhcmFtcy5nZXQoXCJhbmdsZVwiKVxuaWYgKGdsb2JhbFRoaXMuYW5nbGUgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmFuZ2xlID0gXCIwXCIgfVxuZ2xvYmFsVGhpcy5iYWNrZ3JvdW5kID0gdXJsUGFyYW1zLmdldChcImJhY2tncm91bmRcIilcbmlmIChnbG9iYWxUaGlzLmJhY2tncm91bmQgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmJhY2tncm91bmQgPSBcImJsYW5rXCIgfVxuZ2xvYmFsVGhpcy5hbm5vdGF0b3IgPSB1cmxQYXJhbXMuZ2V0KFwiYW5ub3RhdG9yXCIpXG5pZiAoZ2xvYmFsVGhpcy5hbm5vdGF0b3IgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmFubm90YXRvciA9IFwibm9uZVwiIH1cbmdsb2JhbFRoaXMuc2V0ID0gdXJsUGFyYW1zLmdldChcInNldFwiKVxuaWYgKGdsb2JhbFRoaXMuc2V0ID09IG51bGwpIHsgZ2xvYmFsVGhpcy5zZXQgPSBcIjFcIiB9XG5nbG9iYWxUaGlzLnVpZCA9IGAke2dsb2JhbFRoaXMuYXZhdGFyfV9hdmF0YXItJHtnbG9iYWxUaGlzLmFuZ2xlfV9hbmdsZS0ke2dsb2JhbFRoaXMuYmFja2dyb3VuZH1fYmFja2dyb3VuZC1zZXQke2dsb2JhbFRoaXMuc2V0fWBcblxuLy9pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9PSBudWxsKSB7XG4vLyAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydzdHVkeV9pZCddID0gXCJkZW1vX3N0dWR5XCJcbi8vfVxuLy9pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9PSBudWxsKSB7XG4vLyAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydwcm9saWZpY19pZCddID0gXCJkZW1vX3VzZXJcIlxuLy99XG4vL2lmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPT0gbnVsbCkge1xuLy8gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsnc2Vzc2lvbl9pZCddID0gXCJkZW1vX3Nlc3Npb25cIlxuLy99XG5cbi8vIHZlcnNpb24gZm9yIHBhcGVyXG5pZiAoREVWTU9ERSkge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufSBlbHNlIHtcbiAgICBNT0NLTU9ERSA9IHRydWVcbn1cblxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYW5ub3RhdG9yXCIsIGdsb2JhbFRoaXMuYW5ub3RhdG9yKVxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYXZhdGFyXCIsIGdsb2JhbFRoaXMuYXZhdGFyKVxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYW5nbGVcIiwgZ2xvYmFsVGhpcy5hbmdsZSlcbmNvbnNvbGUubG9nKFwiUnVubmluZyB3aXRoIGJhY2tncm91bmRcIiwgZ2xvYmFsVGhpcy5iYWNrZ3JvdW5kKVxuXG5sb2FkX2RhdGEoKS5jYXRjaCgoX2Vycm9yKSA9PiB7XG4gICAgLy9hbGVydChcIkludmFsaWQgdXNlciBpZC5cIilcbiAgICBjb25zb2xlLmxvZyhcIkludmFsaWQgcGFyYW1zOiBcIiwgZ2xvYmFsVGhpcy51cmxfZGF0YSlcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcbn1cbikudGhlbigobmV3X2RhdGEpID0+IHtcbiAgICBkYXRhID0gbmV3X2RhdGFcbiAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4gICAgICAgIHF1ZXN0aW9uX2kgPSBwYXJzZUludChzdGFydE92ZXJyaWRlKSAtIDFcbiAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpXG4gICAgfVxuICAgIC8vIG5leHRfcXVlc3Rpb24oKVxuICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApXG4gICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpXG4gICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxufSlcblxuLy8gLy8gRHluYW1pY2FsbHkgbG9hZCBkYXRhc2V0IGJhc2VkIG9uIERBVEFTRVRcbi8vIGZldGNoKGAuL2Jha2VkX3F1ZXVlcy8ke0RBVEFTRVR9YClcbi8vICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4vLyAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbi8vICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2FkIGRhdGFzZXQuXCIpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4vLyAgICAgfSlcbi8vICAgICAudGhlbigobmV3X2RhdGEpID0+IHtcbi8vICAgICAgICAgZGF0YSA9IG5ld19kYXRhO1xuLy8gICAgICAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4vLyAgICAgICAgICAgICBxdWVzdGlvbl9pID0gcGFyc2VJbnQoc3RhcnRPdmVycmlkZSkgLSAxO1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApO1xuLy8gICAgICAgICB1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMoKTtcbi8vICAgICAgICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpO1xuLy8gICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpO1xuLy8gICAgIH0pXG4vLyAgICAgLmNhdGNoKChfZXJyb3IpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihcIkludmFsaWQgdXNlciBpZCBvciBkYXRhc2V0IGxvYWRpbmcgZmFpbGVkLlwiKTtcbi8vICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgIH0pO1xuXG5cbmNvbnNvbGUubG9nKFwiU3RhcnRpbmcgc2Vzc2lvbiB3aXRoIGFubm90YXRvcjpcIiwgZ2xvYmFsVGhpcy5hbm5vdGF0b3IpXG4iLCJmdW5jdGlvbiBwYXJhbXNUb09iamVjdChlbnRyaWVzKSB7XG4gIGNvbnN0IHJlc3VsdCA9IHt9XG4gIC8vIGVhY2ggJ2VudHJ5JyBpcyBhIFtrZXksIHZhbHVlXSB0dXBwbGVcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZW50cmllcykge1xuICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgcGFyYW1zVG9PYmplY3QgfSJdLCJuYW1lcyI6WyJTRVJWRVJfTE9HX1JPT1QiLCJkYXRhIiwicXVlc3Rpb25faSIsInF1ZXN0aW9uIiwidXNlcl9tY3Ffc2VsZWN0aW9uIiwidXNlcl9pc19jb3JyZWN0IiwiaW5zdHJ1Y3Rpb25faSIsImNvdW50X2V4aXRlZF9wYWdlIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCIkIiwiYXR0ciIsInJlbW92ZUF0dHIiLCJzaG93IiwidmFsIiwiaGlkZSIsIm5leHRfcXVlc3Rpb24iLCJjaGlsZHJlbiIsImVhY2giLCJfIiwiZWwiLCJvbiIsInZpZGVvRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uIiwib3B0aW9uIiwiaSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJTdHJpbmciLCJ0cmltIiwibG9nZ2VkX2RhdGEiLCJhc3luYyIsImdsb2JhbFRoaXMiLCJ1cmxfZGF0YSIsInVpZCIsInJlc3VsdCIsImFqYXgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvamVjdCIsImFubm90YXRvciIsInBheWxvYWQiLCJ0eXBlIiwiY29udGVudFR5cGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzbGVlcCIsImUiLCJsb2dfZGF0YSIsImFjdGl2ZVRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImxlbmd0aCIsInZpZGVvT2JqZWN0Iiwic2V0QXR0cmlidXRlIiwiaHRtbCIsInRleHQiLCJvbnZpc2liaWxpdHljaGFuZ2UiLCJoaWRkZW4iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsInN0YXJ0T3ZlcnJpZGUiLCJnZXQiLCJlbnRyaWVzIiwia2V5IiwidmFsdWUiLCJwYXJhbXNUb09iamVjdCIsImF2YXRhciIsImFuZ2xlIiwiYmFja2dyb3VuZCIsInNldCIsImdldEpTT04iLCJEYXRlIiwibm93IiwibG9hZF9kYXRhIiwiY2F0Y2giLCJfZXJyb3IiLCJyZWxvYWQiLCJ0aGVuIiwibmV3X2RhdGEiLCJwYXJzZUludCJdLCJzb3VyY2VSb290IjoiIn0=