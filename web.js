(()=>{"use strict";let o="https://tejassrinivasan.pythonanywhere.com/";var t=[];let n=-1,i=null,e=-1,a=!1,l=0,s=0;function r(o){l+=o,0==l?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),0==l?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),1==l&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),_()),$("#main_box_instructions").children(":not(input)").each(((o,t)=>{$(t).hide()})),$(`#instructions_${l}`).show()}$("#button_instructions_next").on("click",(()=>r(1))),$("#button_instructions_prev").on("click",(()=>r(-1)));const u=document.getElementById("mime_video");function c(o){e=o,$(`#button_option${o}`).attr("activedecision","true"),a=e==i.label_idx+1,$("#button_next").show()}u?u.addEventListener("ended",(()=>{console.log("The user has watched the full video."),$("#watchvideo_instruction").hide(),$("#answer_box").show()})):console.error('Video element with ID "mime_video" not found.'),$("#answer_box").on("keyup",(()=>{""!=String($("#user_prediction").val()).trim()?$("#button_submit").show():(console.log("The text box is empty."),$("#button_submit").hide())})),$("#button_submit").on("click",(()=>{$("#button_submit").hide(),$("#mcq_box").show(),$("#user_prediction").attr("disabled","true")})),$("#button_option1").on("click",(()=>c(1))),$("#button_option2").on("click",(()=>c(2))),$("#button_option3").on("click",(()=>c(3))),$("#button_option4").on("click",(()=>c(4))),$("#button_next").on("click",(()=>{if(-1!=n){let t={question_i:n,sample_id:i.sample_id,user_answer:$("#user_prediction").val(),user_mcq_selection:e,user_is_correct:a};t.question=i,t.count_exited_page=s,async function(t){t.url_data=globalThis.url_data,console.log("Data"),"study_id"in t.url_data||(t.url_data.study_id="demo_study"),"prolific_id"in t.url_data||(t.url_data.prolific_id="demo_user"),"session_id"in t.url_data||(t.url_data.session_id="demo_session"),t.url_data.queue_id=globalThis.uid,console.log("logged",t),console.log("Logging to",o+"log");try{let n=await $.ajax(o+"log",{data:JSON.stringify({project:"mime-eval-study/human-eval/",uid:globalThis.uid+"_"+globalThis.annotator,payload:JSON.stringify(t)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((o=>setTimeout(o,2e3)))}(),n}catch(o){console.log(o)}}(t),s=0}_()}));let d=null;function _(){if(d&&(clearInterval(d),d=null),n+=1,n>=t.length)return $("#main_box_experiment").hide(),$("#reward_box").show(),void $("#main_box_end").show();i=t[n],console.log(i);let o=document.getElementById("mime_video");o&&o.setAttribute("src",i.s3_url),$("#user_prediction").removeAttr("disabled"),console.log(i.sample_id),console.log(i.s3_url),$("#user_prediction").val(""),$("#option1_span").html(i.options[0]),$("#option2_span").html(i.options[1]),$("#option3_span").html(i.options[2]),$("#option4_span").html(i.options[3]),$("#mime_video").show(),$("#watchvideo_instruction").show(),$("#answer_box").hide();for(let o=1;o<=4;o++)$(`#button_option${o}`).removeAttr("activedecision"),$(`#button_option${o}`).removeAttr("disabled");$("#mcq_box").hide(),$("#button_next").hide(),$("#button_submit").hide(),$("#button_quit").hide(),$("#progress").text(`Progress: ${n+1} / ${t.length}`)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==d&&(clearInterval(d),d=null)):console.log("Window regained focus.")};const g=new URLSearchParams(window.location.search),b=g.get("start");g.get("uid"),globalThis.url_data=function(o){const t={};for(const[n,i]of o)t[n]=i;return t}(g.entries()),globalThis.avatar=g.get("avatar"),null==globalThis.avatar&&(globalThis.avatar="man"),globalThis.angle=g.get("angle"),null==globalThis.angle&&(globalThis.angle="0"),globalThis.background=g.get("background"),null==globalThis.background&&(globalThis.background="blank"),globalThis.annotator=g.get("annotator"),null==globalThis.annotator&&(globalThis.annotator="none"),globalThis.set=g.get("set"),null==globalThis.set&&(globalThis.set="1"),globalThis.uid=`${globalThis.avatar}_avatar-${globalThis.angle}_angle-${globalThis.background}_background-set${globalThis.set}`,console.log("Running with annotator",globalThis.annotator),console.log("Running with avatar",globalThis.avatar),console.log("Running with angle",globalThis.angle),console.log("Running with background",globalThis.background),async function(){return await $.getJSON(`baked_queues/${globalThis.avatar}_avatar-${globalThis.angle}_angle-${globalThis.background}_background-set${globalThis.set}.json?t=${Date.now()}`)}().catch((o=>{console.log("Invalid params: ",globalThis.url_data),window.location.reload()})).then((o=>{t=o,null!=b&&(n=parseInt(b)-1,console.log("Starting from",n)),r(0),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with annotator:",globalThis.annotator)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QVcwQyxNQUFlMUMsV0FBVzBDLElBQU0sS0FDL0MxQyxXQUFXRSxJQUFNLEdBQUdGLFdBQVd1QyxpQkFBaUJ2QyxXQUFXd0MsZUFBZXhDLFdBQVd5Qyw0QkFBNEJ6QyxXQUFXMEMsTUFtQjVIakQsUUFBUUMsSUFBSSx5QkFBMEJNLFdBQVdRLFdBQ2pEZixRQUFRQyxJQUFJLHNCQUF1Qk0sV0FBV3VDLFFBQzlDOUMsUUFBUUMsSUFBSSxxQkFBc0JNLFdBQVd3QyxPQUM3Qy9DLFFBQVFDLElBQUksMEJBQTJCTSxXQUFXeUMsWUR0UzNDMUMsaUJBS0gsYUFIbUJ4QixFQUFFb0UsUUFDakIsZ0JBQWdCM0MsV0FBV3VDLGlCQUFpQnZDLFdBQVd3QyxlQUFleEMsV0FBV3lDLDRCQUE0QnpDLFdBQVcwQyxjQUFjRSxLQUFLQyxRQUduSixDQ2tTQUMsR0FBWUMsT0FBT0MsSUFFZnZELFFBQVFDLElBQUksbUJBQW9CTSxXQUFXQyxVQUMzQzZCLE9BQU9DLFNBQVNrQixRQUFRLElBRTFCQyxNQUFNQyxJQUNKckYsRUFBT3FGLEVBQ2MsTUFBakJsQixJQUNBbEUsRUFBYXFGLFNBQVNuQixHQUFpQixFQUN2Q3hDLFFBQVFDLElBQUksZ0JBQWlCM0IsSUFHakNNLEVBQWtCLEdBQ2xCRSxFQUFFLDBCQUEwQkcsT0FDNUJILEVBQUUsaUNBQWlDSyxNQUFNLElBNEI3Q2EsUUFBUUMsSUFBSSxtQ0FBb0NNLFdBQVdRLFUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9zcmMvY29ubmVjdG9yLnRzIiwid2VicGFjazovLy8uL3NyYy9tYWluLnRzIiwid2VicGFjazovLy8uL3NyYy91dGlscy50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBERVZNT0RFIH0gZnJvbSAnLi9nbG9iYWxzJ1xuaW1wb3J0IHsgTU9DS01PREUgfSBmcm9tICcuL21haW4nXG5cbmxldCBTRVJWRVJfTE9HX1JPT1QgPSBERVZNT0RFID8gXCJodHRwOi8vMTI3LjAuMC4xOjUwMDAvXCIgOiBcImh0dHBzOi8vdGVqYXNzcmluaXZhc2FuLnB5dGhvbmFueXdoZXJlLmNvbS9cIlxuXG5hc3luYyBmdW5jdGlvbiBzbGVlcChtczogbnVtYmVyKTogUHJvbWlzZTx2b2lkPiB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiBzZXRUaW1lb3V0KHJlc29sdmUsIG1zKSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2FkX2RhdGEoKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvLyBpbmNsdWRlIHRpbWVzdGFtcCBzbyB0aGF0IHRoaW5ncyBkb24ndCBnZXQgY2FjaGVkXG4gICAgbGV0IHJlc3VsdCA9IGF3YWl0ICQuZ2V0SlNPTihcbiAgICAgICAgYGJha2VkX3F1ZXVlcy8ke2dsb2JhbFRoaXMuYXZhdGFyfV9hdmF0YXItJHtnbG9iYWxUaGlzLmFuZ2xlfV9hbmdsZS0ke2dsb2JhbFRoaXMuYmFja2dyb3VuZH1fYmFja2dyb3VuZC1zZXQke2dsb2JhbFRoaXMuc2V0fS5qc29uP3Q9JHtEYXRlLm5vdygpfWAsXG4gICAgKVxuICAgIHJldHVybiByZXN1bHRcbn1cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dfZGF0YShkYXRhKTogUHJvbWlzZTxhbnk+IHtcbiAgICAvL2lmIChNT0NLTU9ERSkge1xuICAgIC8vICAgIGNvbnNvbGUubG9nKFwibG9nZ2VkIChtb2NrKVwiLCBkYXRhKVxuICAgIC8vICAgIHJldHVyblxuICAgIC8vfVxuICAgIFxuICAgIGRhdGFbXCJ1cmxfZGF0YVwiXSA9IGdsb2JhbFRoaXMudXJsX2RhdGFcbiAgICBjb25zb2xlLmxvZyhcIkRhdGFcIilcbiAgICBpZiAoIShcInN0dWR5X2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInN0dWR5X2lkXCJdID0gXCJkZW1vX3N0dWR5XCJcbiAgICB9XG4gICAgaWYgKCEoXCJwcm9saWZpY19pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJwcm9saWZpY19pZFwiXSA9IFwiZGVtb191c2VyXCJcbiAgICB9XG4gICAgaWYgKCEoXCJzZXNzaW9uX2lkXCIgaW4gZGF0YVsndXJsX2RhdGEnXSkpIHtcbiAgICAgICAgZGF0YVsndXJsX2RhdGEnXVtcInNlc3Npb25faWRcIl0gPSBcImRlbW9fc2Vzc2lvblwiXG4gICAgfVxuICAgIGRhdGFbXCJ1cmxfZGF0YVwiXVtcInF1ZXVlX2lkXCJdID0gZ2xvYmFsVGhpcy51aWRcbiAgICBjb25zb2xlLmxvZyhcImxvZ2dlZFwiLCBkYXRhKVxuICAgIGNvbnNvbGUubG9nKFwiTG9nZ2luZyB0b1wiLCBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiKVxuXG4gICAgdHJ5IHtcbiAgICAgICAgbGV0IHJlc3VsdCA9IGF3YWl0ICQuYWpheChcbiAgICAgICAgICAgIFNFUlZFUl9MT0dfUk9PVCArIFwibG9nXCIsXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgZGF0YTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBwcm9qZWN0OiBcIm1pbWUtZXZhbC1zdHVkeS9odW1hbi1ldmFsL1wiLFxuICAgICAgICAgICAgICAgICAgICB1aWQ6IGdsb2JhbFRoaXMudWlkICsgXCJfXCIgKyBnbG9iYWxUaGlzLmFubm90YXRvcixcbiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZDogSlNPTi5zdHJpbmdpZnkoZGF0YSksXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgICAgdHlwZTogJ1BPU1QnLFxuICAgICAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG4gICAgICAgICAgICB9XG4gICAgICAgIClcbiAgICAgICAgYXdhaXQgc2xlZXAoMjAwMCk7XG4gICAgICAgIHJldHVybiByZXN1bHRcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKGUpXG4gICAgfVxufSIsImltcG9ydCB7IERFVk1PREUsIFJFV0FSRF9DT1JSRUNULCBQRU5BTFRZX0lOQ09SUkVDVCwgRU5BQkxFX1RJTUVSIH0gZnJvbSBcIi4vZ2xvYmFsc1wiXG5leHBvcnQgdmFyIFVJRDogc3RyaW5nXG5leHBvcnQgdmFyIE1PQ0tNT0RFOiBib29sZWFuID0gZmFsc2VcbmltcG9ydCB7IGxvYWRfZGF0YSwgbG9nX2RhdGEgfSBmcm9tICcuL2Nvbm5lY3RvcidcbmltcG9ydCB7IHBhcmFtc1RvT2JqZWN0IH0gZnJvbSBcIi4vdXRpbHNcIlxuXG52YXIgZGF0YTogYW55W10gPSBbXVxubGV0IHF1ZXN0aW9uX2kgPSAtMVxubGV0IHF1ZXN0aW9uOiBhbnkgPSBudWxsXG5cblxubGV0IGJhbGFuY2UgPSAwXG5cbmxldCB1c2VyX21jcV9zZWxlY3Rpb24gPSAtMVxubGV0IHVzZXJfaXNfY29ycmVjdCA9IGZhbHNlXG5cbmxldCBpbnN0cnVjdGlvbl9pOiBudW1iZXIgPSAwXG5sZXQgY291bnRfZXhpdGVkX3BhZ2U6IG51bWJlciA9IDBcblxuZnVuY3Rpb24gYXNzZXJ0KGNvbmRpdGlvbiwgbWVzc2FnZSkge1xuICAgIGlmICghY29uZGl0aW9uKSB7XG4gICAgICAgIHRocm93IG1lc3NhZ2UgfHwgXCJBc3NlcnRpb24gZmFpbGVkXCI7XG4gICAgfVxufVxuXG5cbmZ1bmN0aW9uIG5leHRfaW5zdHJ1Y3Rpb25zKGluY3JlbWVudDogbnVtYmVyKSB7XG4gICAgaW5zdHJ1Y3Rpb25faSArPSBpbmNyZW1lbnRcblxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDApIHtcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxuICAgIH0gZWxzZSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuICAgIH1cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSAwKSB7XG4gICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5zaG93KClcbiAgICAgICAgJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX25leHRcIikudmFsKFwiU3RhcnQgc3R1ZHlcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIk5leHRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gMSkge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuc2hvdygpXG4gICAgICAgIG5leHRfcXVlc3Rpb24oKVxuICAgIH1cblxuICAgICQoXCIjbWFpbl9ib3hfaW5zdHJ1Y3Rpb25zXCIpLmNoaWxkcmVuKFwiOm5vdChpbnB1dClcIikuZWFjaCgoXywgZWwpID0+IHtcbiAgICAgICAgJChlbCkuaGlkZSgpXG4gICAgfSlcbiAgICAkKGAjaW5zdHJ1Y3Rpb25zXyR7aW5zdHJ1Y3Rpb25faX1gKS5zaG93KClcbn1cbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoKzEpKVxuJChcIiNidXR0b25faW5zdHJ1Y3Rpb25zX3ByZXZcIikub24oXCJjbGlja1wiLCAoKSA9PiBuZXh0X2luc3RydWN0aW9ucygtMSkpXG5cbi8vIEFkZCBsaXN0ZW5lciB0byBlbnN1cmUgdGhlIHZpZGVvIGhhcyBiZWVuIHdhdGNoZWRcbmNvbnN0IHZpZGVvRWxlbWVudCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtaW1lX3ZpZGVvJyk7XG5cbmlmICh2aWRlb0VsZW1lbnQpIHtcbiAgICAvLyBBZGQgYW4gZXZlbnQgbGlzdGVuZXIgZm9yIHRoZSAnZW5kZWQnIGV2ZW50XG4gICAgdmlkZW9FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgKCkgPT4ge1xuICAgICAgICBjb25zb2xlLmxvZygnVGhlIHVzZXIgaGFzIHdhdGNoZWQgdGhlIGZ1bGwgdmlkZW8uJyk7XG4gICAgICAgIC8vIFlvdSBjYW4gYWRkIGFkZGl0aW9uYWwgYWN0aW9ucyBoZXJlLCBzdWNoIGFzIG1hcmtpbmcgdGhlIHZpZGVvIGFzIHdhdGNoZWRcbiAgICAgICAgJChcIiN3YXRjaHZpZGVvX2luc3RydWN0aW9uXCIpLmhpZGUoKVxuICAgICAgICAvLyQoXCIjdXNlcl9wcmVkaWN0aW9uXCIpLnZhbChcIlwiKVxuICAgICAgICAkKFwiI2Fuc3dlcl9ib3hcIikuc2hvdygpXG4gICAgfSk7XG59IGVsc2Uge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1ZpZGVvIGVsZW1lbnQgd2l0aCBJRCBcIm1pbWVfdmlkZW9cIiBub3QgZm91bmQuJyk7XG59XG5cblxuJCgnI2Fuc3dlcl9ib3gnKS5vbigna2V5dXAnLCAoKSA9PiB7XG4gICAgbGV0IHVzZXJfcHJlZGljdGlvbiA9IFN0cmluZygkKCcjdXNlcl9wcmVkaWN0aW9uJykudmFsKCkpLnRyaW0oKVxuICAgIGlmICh1c2VyX3ByZWRpY3Rpb24gIT0gJycpIHtcbiAgICAgICAgJChcIiNidXR0b25fc3VibWl0XCIpLnNob3coKVxuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdUaGUgdGV4dCBib3ggaXMgZW1wdHkuJyk7XG4gICAgICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5oaWRlKClcbiAgICB9XG59KTtcblxuJChcIiNidXR0b25fc3VibWl0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5oaWRlKClcbiAgICAkKFwiI21jcV9ib3hcIikuc2hvdygpXG4gICAgLy8gRGlzYWJsZSB0aGUgdGV4dCBib3hcbiAgICAkKFwiI3VzZXJfcHJlZGljdGlvblwiKS5hdHRyKFwiZGlzYWJsZWRcIiwgXCJ0cnVlXCIpXG59KTtcblxuZnVuY3Rpb24gcmVnaXN0ZXJfbWNxX3NlbGVjdGlvbihvcHRpb24pIHtcbiAgICB1c2VyX21jcV9zZWxlY3Rpb24gPSBvcHRpb25cbiAgICAvL2ZvciAobGV0IGkgPSAxOyBpIDw9IDQ7IGkrKykge1xuICAgIC8vICAgICQoYCNidXR0b25fb3B0aW9uJHtpfWApLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICAvL31cbiAgICAkKGAjYnV0dG9uX29wdGlvbiR7b3B0aW9ufWApLmF0dHIoXCJhY3RpdmVkZWNpc2lvblwiLCBcInRydWVcIilcbiAgICB1c2VyX2lzX2NvcnJlY3QgPSAodXNlcl9tY3Ffc2VsZWN0aW9uID09IHF1ZXN0aW9uWydsYWJlbF9pZHgnXSsxKSA/IHRydWUgOiBmYWxzZVxuXG4gICAgJChcIiNidXR0b25fbmV4dFwiKS5zaG93KClcbn1cbiQoXCIjYnV0dG9uX29wdGlvbjFcIikub24oXCJjbGlja1wiLCAoKSA9PiByZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uKDEpKVxuJChcIiNidXR0b25fb3B0aW9uMlwiKS5vbihcImNsaWNrXCIsICgpID0+IHJlZ2lzdGVyX21jcV9zZWxlY3Rpb24oMikpXG4kKFwiI2J1dHRvbl9vcHRpb24zXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gcmVnaXN0ZXJfbWNxX3NlbGVjdGlvbigzKSlcbiQoXCIjYnV0dG9uX29wdGlvbjRcIikub24oXCJjbGlja1wiLCAoKSA9PiByZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uKDQpKVxuXG5cbiQoXCIjYnV0dG9uX25leHRcIikub24oXCJjbGlja1wiLCAoKSA9PiB7XG5cbiAgICAvLyBVcGRhdGUgdGhlIHVzZXIgYmFsYW5jZVxuICAgIGlmIChxdWVzdGlvbl9pICE9IC0xKSB7XG4gICAgICAgIGxldCBsb2dnZWRfZGF0YSA9IHtcbiAgICAgICAgICAgIFwicXVlc3Rpb25faVwiOiBxdWVzdGlvbl9pLFxuICAgICAgICAgICAgXCJzYW1wbGVfaWRcIjogcXVlc3Rpb25bJ3NhbXBsZV9pZCddLFxuICAgICAgICAgICAgXCJ1c2VyX2Fuc3dlclwiOiAkKFwiI3VzZXJfcHJlZGljdGlvblwiKS52YWwoKSxcbiAgICAgICAgICAgIFwidXNlcl9tY3Ffc2VsZWN0aW9uXCI6IHVzZXJfbWNxX3NlbGVjdGlvbixcbiAgICAgICAgICAgIFwidXNlcl9pc19jb3JyZWN0XCI6IHVzZXJfaXNfY29ycmVjdCxcbiAgICAgICAgfVxuICAgICAgICBsb2dnZWRfZGF0YVsncXVlc3Rpb24nXSA9IHF1ZXN0aW9uXG4gICAgICAgIGxvZ2dlZF9kYXRhWydjb3VudF9leGl0ZWRfcGFnZSddID0gY291bnRfZXhpdGVkX3BhZ2VcbiAgICAgICAgbG9nX2RhdGEobG9nZ2VkX2RhdGEpXG4gICAgICAgIGNvdW50X2V4aXRlZF9wYWdlID0gMFxuICAgIH1cbiAgICBcblxuICAgIG5leHRfcXVlc3Rpb24oKVxufSk7XG5cblxubGV0IGFjdGl2ZVRpbWVyOiBSZXR1cm5UeXBlPHR5cGVvZiBzZXRJbnRlcnZhbD4gfCBudWxsID0gbnVsbDsgLy8gVGltZXIgaW50ZXJ2YWxcblxuZnVuY3Rpb24gc3RhcnRUaW1lcihkdXJhdGlvbiwgc3RlcERpdiwgYnV0dG9ucywgY2FsbGJhY2spIHtcbiAgICBpZiAoIUVOQUJMRV9USU1FUikge1xuICAgICAgICAvLyBJZiB0aGUgdGltZXIgaXMgZGlzYWJsZWQsIGVuYWJsZSB0aGUgYnV0dG9ucyBpbW1lZGlhdGVseVxuICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSk7XG4gICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIENsZWFyIGFueSBleGlzdGluZyB0aW1lciB0byBwcmV2ZW50IG11bHRpcGxlIGludGVydmFsc1xuICAgIGlmIChhY3RpdmVUaW1lcikge1xuICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTtcbiAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIERpc2FibGUgYnV0dG9uc1xuICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnNldEF0dHJpYnV0ZShcImRpc2FibGVkXCIsIFwidHJ1ZVwiKSk7XG4gICAgXG4gICAgLy8gU2hvdyB0aW1lciB2aXN1YWxseVxuICAgIGxldCB0aW1lckRpc3BsYXkgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICB0aW1lckRpc3BsYXkuaWQgPSBgdGltZXJfJHtzdGVwRGl2LmlkfWA7XG4gICAgdGltZXJEaXNwbGF5LnN0eWxlLmZvbnRXZWlnaHQgPSAnYm9sZCc7XG4gICAgdGltZXJEaXNwbGF5LnN0eWxlLm1hcmdpblRvcCA9ICcxMHB4JztcbiAgICBzdGVwRGl2LmFwcGVuZENoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICBsZXQgcmVtYWluaW5nVGltZSA9IGR1cmF0aW9uO1xuXG4gICAgLy8gSW5pdGlhbCBkaXNwbGF5XG4gICAgdGltZXJEaXNwbGF5LnRleHRDb250ZW50ID0gYFBsZWFzZSB3YWl0ICR7cmVtYWluaW5nVGltZX0gc2Vjb25kKHMpIGJlZm9yZSBtYWtpbmcgeW91ciBzZWxlY3Rpb24uYDtcblxuICAgIGFjdGl2ZVRpbWVyID0gc2V0SW50ZXJ2YWwoKCkgPT4ge1xuICAgICAgICByZW1haW5pbmdUaW1lLS07XG4gICAgICAgIGlmIChyZW1haW5pbmdUaW1lID49IDApIHtcbiAgICAgICAgICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG4gICAgICAgIH0gZWxzZSB7XG5cbiAgICAgICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpOyAvLyBTdG9wIHRoZSB0aW1lclxuICAgICAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcblxuICAgICAgICAgICAgLy8gUmVtb3ZlIHRpbWVyIGRpc3BsYXlcbiAgICAgICAgICAgIHN0ZXBEaXYucmVtb3ZlQ2hpbGQodGltZXJEaXNwbGF5KTtcblxuICAgICAgICAgICAgLy8gRW5hYmxlIGJ1dHRvbnNcbiAgICAgICAgICAgIGJ1dHRvbnMuZm9yRWFjaChidXR0b24gPT4gYnV0dG9uLnJlbW92ZUF0dHJpYnV0ZShcImRpc2FibGVkXCIpKTtcblxuICAgICAgICAgICAgaWYgKGNhbGxiYWNrKSBjYWxsYmFjaygpO1xuICAgICAgICB9XG4gICAgfSwgMTAwMCk7XG59XG5cbi8vIFdoZW4gdGhlIHVzZXIgc3dpdGNoZXMgdGFicyBvciBtaW5pbWl6ZXMgdGhlIHdpbmRvdywgcGF1c2UgdGhlIHRpbWVyXG5kb2N1bWVudC5vbnZpc2liaWxpdHljaGFuZ2UgPSAoKSA9PiB7XG4gICAgaWYgKGRvY3VtZW50LmhpZGRlbikge1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyBsb3N0IGZvY3VzLlwiKTtcbiAgICAgICAgaWYgKGFjdGl2ZVRpbWVyICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gUGF1c2UgdGhlIHRpbWVyXG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgICAvLyBIYW5kbGUgbG9naWMgd2hlbiB0aGUgdXNlciByZXR1cm5zXG4gICAgICAgIGNvbnNvbGUubG9nKFwiV2luZG93IHJlZ2FpbmVkIGZvY3VzLlwiKTtcbiAgICB9XG59O1xuXG5cblxuZnVuY3Rpb24gbmV4dF9xdWVzdGlvbigpIHtcbiAgICAvLyBSZXNldCB0aW1lcnMgYW5kIHN0YXRlXG4gICAgaWYgKGFjdGl2ZVRpbWVyKSB7XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoYWN0aXZlVGltZXIpO1xuICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgfVxuXG4gICAgLy8gcmVzdG9yZSBwcmV2aW91cyBzdGF0ZSBvZiBVSVxuXG4gICAgLy8kKFwiI3JhbmdlX3ZhbFwiKS52YWwodXNlcl90cnVzdClcblxuICAgIHF1ZXN0aW9uX2kgKz0gMVxuICAgIGlmIChxdWVzdGlvbl9pID49IGRhdGEubGVuZ3RoKSB7XG4gICAgICAgICQoXCIjbWFpbl9ib3hfZXhwZXJpbWVudFwiKS5oaWRlKClcbiAgICAgICAgJCgnI3Jld2FyZF9ib3gnKS5zaG93KClcbiAgICAgICAgJChcIiNtYWluX2JveF9lbmRcIikuc2hvdygpXG4gICAgICAgIHJldHVyblxuICAgIH1cblxuICAgIHF1ZXN0aW9uID0gZGF0YVtxdWVzdGlvbl9pXVxuICAgIGNvbnNvbGUubG9nKHF1ZXN0aW9uKVxuXG4gICAgbGV0IHZpZGVvT2JqZWN0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJtaW1lX3ZpZGVvXCIpXG4gICAgaWYgKHZpZGVvT2JqZWN0KSB7XG4gICAgICAgIHZpZGVvT2JqZWN0LnNldEF0dHJpYnV0ZShcInNyY1wiLCBxdWVzdGlvblsnczNfdXJsJ10pXG4gICAgfVxuICAgICQoXCIjdXNlcl9wcmVkaWN0aW9uXCIpLnJlbW92ZUF0dHIoXCJkaXNhYmxlZFwiKVxuXG4gICAgY29uc29sZS5sb2cocXVlc3Rpb25bJ3NhbXBsZV9pZCddKVxuICAgIGNvbnNvbGUubG9nKHF1ZXN0aW9uWydzM191cmwnXSlcbiAgICAkKFwiI3VzZXJfcHJlZGljdGlvblwiKS52YWwoXCJcIilcbiAgICAkKFwiI29wdGlvbjFfc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcIm9wdGlvbnNcIl1bMF0pXG4gICAgJChcIiNvcHRpb24yX3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJvcHRpb25zXCJdWzFdKVxuICAgICQoXCIjb3B0aW9uM19zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wib3B0aW9uc1wiXVsyXSlcbiAgICAkKFwiI29wdGlvbjRfc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcIm9wdGlvbnNcIl1bM10pXG5cbiAgICAkKFwiI21pbWVfdmlkZW9cIikuc2hvdygpXG4gICAgJChcIiN3YXRjaHZpZGVvX2luc3RydWN0aW9uXCIpLnNob3coKVxuICAgICQoJyNhbnN3ZXJfYm94JykuaGlkZSgpXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNDsgaSsrKSB7XG4gICAgICAgICQoYCNidXR0b25fb3B0aW9uJHtpfWApLnJlbW92ZUF0dHIoXCJhY3RpdmVkZWNpc2lvblwiKVxuICAgICAgICAkKGAjYnV0dG9uX29wdGlvbiR7aX1gKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICB9XG4gICAgJChcIiNtY3FfYm94XCIpLmhpZGUoKVxuICAgICQoXCIjYnV0dG9uX25leHRcIikuaGlkZSgpXG4gICAgJChcIiNidXR0b25fc3VibWl0XCIpLmhpZGUoKVxuICAgICQoJyNidXR0b25fcXVpdCcpLmhpZGUoKVxuXG5cbiAgICAvLyBzZXQgYmV0IHZhbHVlIHJhdGlvXG4gICAgLy9pZihxdWVzdGlvbi5oYXNPd25Qcm9wZXJ0eShcInJld2FyZF9yYXRpb1wiKSkge1xuICAgIC8vICAgIGxldCBbcmF0aW8xLCByYXRpbzJdID0gcXVlc3Rpb25bXCJyZXdhcmRfcmF0aW9cIl1cbiAgICAvLyAgICByYXRpbzEgPSBOdW1iZXIocmF0aW8xKVxuICAgIC8vICAgIHJhdGlvMiA9IE51bWJlcihyYXRpbzIpXG4gICAgLy8gICAgYmV0X3ZhbF9yYXRpbyA9IHJhdGlvMS9yYXRpbzJcbiAgICAvL30gZWxzZSB7XG4gICAgLy8gICAgYmV0X3ZhbF9yYXRpbyA9IDFcbiAgICAvL31cblxuICAgIC8vdGltZV9xdWVzdGlvbl9zdGFydCA9IERhdGUubm93KClcbiAgICAkKFwiI3Byb2dyZXNzXCIpLnRleHQoYFByb2dyZXNzOiAke3F1ZXN0aW9uX2kgKyAxfSAvICR7ZGF0YS5sZW5ndGh9YClcblxufVxuXG5cblxuLy8gZ2V0IHVzZXIgaWQgYW5kIGxvYWQgcXVldWVcbi8vIHRyeSB0byBzZWUgaWYgc3RhcnQgb3ZlcnJpZGUgd2FzIHBhc3NlZFxuY29uc3QgdXJsUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh3aW5kb3cubG9jYXRpb24uc2VhcmNoKTtcbmNvbnN0IHN0YXJ0T3ZlcnJpZGUgPSB1cmxQYXJhbXMuZ2V0KCdzdGFydCcpO1xuY29uc3QgVUlERnJvbVVSTCA9IHVybFBhcmFtcy5nZXQoXCJ1aWRcIilcbmdsb2JhbFRoaXMudXJsX2RhdGEgPSBwYXJhbXNUb09iamVjdCh1cmxQYXJhbXMuZW50cmllcygpKVxuXG5nbG9iYWxUaGlzLmF2YXRhciA9IHVybFBhcmFtcy5nZXQoXCJhdmF0YXJcIilcbmlmIChnbG9iYWxUaGlzLmF2YXRhciA9PSBudWxsKSB7IGdsb2JhbFRoaXMuYXZhdGFyID0gXCJtYW5cIiB9XG5nbG9iYWxUaGlzLmFuZ2xlID0gdXJsUGFyYW1zLmdldChcImFuZ2xlXCIpXG5pZiAoZ2xvYmFsVGhpcy5hbmdsZSA9PSBudWxsKSB7IGdsb2JhbFRoaXMuYW5nbGUgPSBcIjBcIiB9XG5nbG9iYWxUaGlzLmJhY2tncm91bmQgPSB1cmxQYXJhbXMuZ2V0KFwiYmFja2dyb3VuZFwiKVxuaWYgKGdsb2JhbFRoaXMuYmFja2dyb3VuZCA9PSBudWxsKSB7IGdsb2JhbFRoaXMuYmFja2dyb3VuZCA9IFwiYmxhbmtcIiB9XG5nbG9iYWxUaGlzLmFubm90YXRvciA9IHVybFBhcmFtcy5nZXQoXCJhbm5vdGF0b3JcIilcbmlmIChnbG9iYWxUaGlzLmFubm90YXRvciA9PSBudWxsKSB7IGdsb2JhbFRoaXMuYW5ub3RhdG9yID0gXCJub25lXCIgfVxuZ2xvYmFsVGhpcy5zZXQgPSB1cmxQYXJhbXMuZ2V0KFwic2V0XCIpXG5pZiAoZ2xvYmFsVGhpcy5zZXQgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLnNldCA9IFwiMVwiIH1cbmdsb2JhbFRoaXMudWlkID0gYCR7Z2xvYmFsVGhpcy5hdmF0YXJ9X2F2YXRhci0ke2dsb2JhbFRoaXMuYW5nbGV9X2FuZ2xlLSR7Z2xvYmFsVGhpcy5iYWNrZ3JvdW5kfV9iYWNrZ3JvdW5kLXNldCR7Z2xvYmFsVGhpcy5zZXR9YFxuXG4vL2lmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzdHVkeV9pZCddID09IG51bGwpIHtcbi8vICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3N0dWR5X2lkJ10gPSBcImRlbW9fc3R1ZHlcIlxuLy99XG4vL2lmIChnbG9iYWxUaGlzLnVybF9kYXRhWydwcm9saWZpY19pZCddID09IG51bGwpIHtcbi8vICAgIGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Byb2xpZmljX2lkJ10gPSBcImRlbW9fdXNlclwiXG4vL31cbi8vaWYgKGdsb2JhbFRoaXMudXJsX2RhdGFbJ3Nlc3Npb25faWQnXSA9PSBudWxsKSB7XG4vLyAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPSBcImRlbW9fc2Vzc2lvblwiXG4vL31cblxuLy8gdmVyc2lvbiBmb3IgcGFwZXJcbmlmIChERVZNT0RFKSB7XG4gICAgTU9DS01PREUgPSB0cnVlXG59IGVsc2Uge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufVxuXG5jb25zb2xlLmxvZyhcIlJ1bm5pbmcgd2l0aCBhbm5vdGF0b3JcIiwgZ2xvYmFsVGhpcy5hbm5vdGF0b3IpXG5jb25zb2xlLmxvZyhcIlJ1bm5pbmcgd2l0aCBhdmF0YXJcIiwgZ2xvYmFsVGhpcy5hdmF0YXIpXG5jb25zb2xlLmxvZyhcIlJ1bm5pbmcgd2l0aCBhbmdsZVwiLCBnbG9iYWxUaGlzLmFuZ2xlKVxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYmFja2dyb3VuZFwiLCBnbG9iYWxUaGlzLmJhY2tncm91bmQpXG5cbmxvYWRfZGF0YSgpLmNhdGNoKChfZXJyb3IpID0+IHtcbiAgICAvL2FsZXJ0KFwiSW52YWxpZCB1c2VyIGlkLlwiKVxuICAgIGNvbnNvbGUubG9nKFwiSW52YWxpZCBwYXJhbXM6IFwiLCBnbG9iYWxUaGlzLnVybF9kYXRhKVxuICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKVxufVxuKS50aGVuKChuZXdfZGF0YSkgPT4ge1xuICAgIGRhdGEgPSBuZXdfZGF0YVxuICAgIGlmIChzdGFydE92ZXJyaWRlICE9IG51bGwpIHtcbiAgICAgICAgcXVlc3Rpb25faSA9IHBhcnNlSW50KHN0YXJ0T3ZlcnJpZGUpIC0gMVxuICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXJ0aW5nIGZyb21cIiwgcXVlc3Rpb25faSlcbiAgICB9XG4gICAgLy8gbmV4dF9xdWVzdGlvbigpXG4gICAgbmV4dF9pbnN0cnVjdGlvbnMoMClcbiAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5zaG93KClcbiAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpXG59KVxuXG4vLyAvLyBEeW5hbWljYWxseSBsb2FkIGRhdGFzZXQgYmFzZWQgb24gREFUQVNFVFxuLy8gZmV0Y2goYC4vYmFrZWRfcXVldWVzLyR7REFUQVNFVH1gKVxuLy8gICAgIC50aGVuKHJlc3BvbnNlID0+IHtcbi8vICAgICAgICAgaWYgKCFyZXNwb25zZS5vaykge1xuLy8gICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRmFpbGVkIHRvIGxvYWQgZGF0YXNldC5cIik7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgcmV0dXJuIHJlc3BvbnNlLmpzb24oKTtcbi8vICAgICB9KVxuLy8gICAgIC50aGVuKChuZXdfZGF0YSkgPT4ge1xuLy8gICAgICAgICBkYXRhID0gbmV3X2RhdGE7XG4vLyAgICAgICAgIGlmIChzdGFydE92ZXJyaWRlICE9IG51bGwpIHtcbi8vICAgICAgICAgICAgIHF1ZXN0aW9uX2kgPSBwYXJzZUludChzdGFydE92ZXJyaWRlKSAtIDE7XG4vLyAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN0YXJ0aW5nIGZyb21cIiwgcXVlc3Rpb25faSk7XG4vLyAgICAgICAgIH1cbi8vICAgICAgICAgbmV4dF9pbnN0cnVjdGlvbnMoMCk7XG4vLyAgICAgICAgIHVwZGF0ZVJld2FyZEluc3RydWN0aW9ucygpO1xuLy8gICAgICAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5zaG93KCk7XG4vLyAgICAgICAgICQoXCIjaW5zdHJ1Y3Rpb25zX2FuZF9kZWNvcmF0aW9uc1wiKS5oaWRlKCk7XG4vLyAgICAgfSlcbi8vICAgICAuY2F0Y2goKF9lcnJvcikgPT4ge1xuLy8gICAgICAgICBjb25zb2xlLmVycm9yKFwiSW52YWxpZCB1c2VyIGlkIG9yIGRhdGFzZXQgbG9hZGluZyBmYWlsZWQuXCIpO1xuLy8gICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XG4vLyAgICAgfSk7XG5cblxuY29uc29sZS5sb2coXCJTdGFydGluZyBzZXNzaW9uIHdpdGggYW5ub3RhdG9yOlwiLCBnbG9iYWxUaGlzLmFubm90YXRvcilcbiIsImZ1bmN0aW9uIHBhcmFtc1RvT2JqZWN0KGVudHJpZXMpIHtcbiAgY29uc3QgcmVzdWx0ID0ge31cbiAgLy8gZWFjaCAnZW50cnknIGlzIGEgW2tleSwgdmFsdWVdIHR1cHBsZVxuICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBlbnRyaWVzKSB7XG4gICAgcmVzdWx0W2tleV0gPSB2YWx1ZTtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgeyBwYXJhbXNUb09iamVjdCB9Il0sIm5hbWVzIjpbIlNFUlZFUl9MT0dfUk9PVCIsImRhdGEiLCJxdWVzdGlvbl9pIiwicXVlc3Rpb24iLCJ1c2VyX21jcV9zZWxlY3Rpb24iLCJ1c2VyX2lzX2NvcnJlY3QiLCJpbnN0cnVjdGlvbl9pIiwiY291bnRfZXhpdGVkX3BhZ2UiLCJuZXh0X2luc3RydWN0aW9ucyIsImluY3JlbWVudCIsIiQiLCJhdHRyIiwicmVtb3ZlQXR0ciIsInNob3ciLCJ2YWwiLCJoaWRlIiwibmV4dF9xdWVzdGlvbiIsImNoaWxkcmVuIiwiZWFjaCIsIl8iLCJlbCIsIm9uIiwidmlkZW9FbGVtZW50IiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInJlZ2lzdGVyX21jcV9zZWxlY3Rpb24iLCJvcHRpb24iLCJhZGRFdmVudExpc3RlbmVyIiwiY29uc29sZSIsImxvZyIsImVycm9yIiwiU3RyaW5nIiwidHJpbSIsImxvZ2dlZF9kYXRhIiwiYXN5bmMiLCJnbG9iYWxUaGlzIiwidXJsX2RhdGEiLCJ1aWQiLCJyZXN1bHQiLCJhamF4IiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2plY3QiLCJhbm5vdGF0b3IiLCJwYXlsb2FkIiwidHlwZSIsImNvbnRlbnRUeXBlIiwiUHJvbWlzZSIsInJlc29sdmUiLCJzZXRUaW1lb3V0Iiwic2xlZXAiLCJlIiwibG9nX2RhdGEiLCJhY3RpdmVUaW1lciIsImNsZWFySW50ZXJ2YWwiLCJsZW5ndGgiLCJ2aWRlb09iamVjdCIsInNldEF0dHJpYnV0ZSIsImh0bWwiLCJpIiwidGV4dCIsIm9udmlzaWJpbGl0eWNoYW5nZSIsImhpZGRlbiIsInVybFBhcmFtcyIsIlVSTFNlYXJjaFBhcmFtcyIsIndpbmRvdyIsImxvY2F0aW9uIiwic2VhcmNoIiwic3RhcnRPdmVycmlkZSIsImdldCIsImVudHJpZXMiLCJrZXkiLCJ2YWx1ZSIsInBhcmFtc1RvT2JqZWN0IiwiYXZhdGFyIiwiYW5nbGUiLCJiYWNrZ3JvdW5kIiwic2V0IiwiZ2V0SlNPTiIsIkRhdGUiLCJub3ciLCJsb2FkX2RhdGEiLCJjYXRjaCIsIl9lcnJvciIsInJlbG9hZCIsInRoZW4iLCJuZXdfZGF0YSIsInBhcnNlSW50Il0sInNvdXJjZVJvb3QiOiIifQ==