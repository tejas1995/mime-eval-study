(()=>{"use strict";let o="https://tejassrinivasan.pythonanywhere.com/";var t=[];let n=-1,i=null,e=-1,a=!1,l=0,s=0;function r(o){l+=o,0==l?$("#button_instructions_prev").attr("disabled","true"):$("#button_instructions_prev").removeAttr("disabled"),0==l?($("#instructions_and_decorations").show(),$("#button_instructions_next").val("Start study")):($("#instructions_and_decorations").hide(),$("#button_instructions_next").val("Next")),1==l&&($("#instructions_and_decorations").show(),$("#main_box_instructions").hide(),$("#main_box_experiment").show(),_()),$("#main_box_instructions").children(":not(input)").each(((o,t)=>{$(t).hide()})),$(`#instructions_${l}`).show()}$("#button_instructions_next").on("click",(()=>r(1))),$("#button_instructions_prev").on("click",(()=>r(-1)));const u=document.getElementById("mime_video");function c(o){e=o;for(let o=1;o<=4;o++)$(`#button_option${o}`).attr("disabled","true");$(`#button_option${o}`).attr("activedecision","true"),a=e==i.label_idx+1,$("#button_next").show()}u?u.addEventListener("ended",(()=>{console.log("The user has watched the full video."),$("#watchvideo_instruction").hide(),$("#answer_box").show()})):console.error('Video element with ID "mime_video" not found.'),$("#answer_box").on("keyup",(()=>{""!=String($("#user_prediction").val()).trim()?$("#button_submit").show():(console.log("The text box is empty."),$("#button_submit").hide())})),$("#button_submit").on("click",(()=>{$("#button_submit").hide(),$("#mcq_box").show(),$("#user_prediction").attr("disabled","true")})),$("#button_option1").on("click",(()=>c(1))),$("#button_option2").on("click",(()=>c(2))),$("#button_option3").on("click",(()=>c(3))),$("#button_option4").on("click",(()=>c(4))),$("#button_next").on("click",(()=>{if(-1!=n){let t={question_i:n,sample_id:i.sample_id,user_answer:$("#user_prediction").val(),user_mcq_selection:e,user_is_correct:a};t.question=i,t.count_exited_page=s,async function(t){t.url_data=globalThis.url_data,console.log("Data"),"study_id"in t.url_data||(t.url_data.study_id="demo_study"),"prolific_id"in t.url_data||(t.url_data.prolific_id="demo_user"),"session_id"in t.url_data||(t.url_data.session_id="demo_session"),t.url_data.queue_id=globalThis.uid,console.log("logged",t),console.log("Logging to",o+"log");try{let n=await $.ajax(o+"log",{data:JSON.stringify({project:"mime-eval-study/human-eval/",uid:globalThis.uid+"_"+globalThis.annotator,payload:JSON.stringify(t)}),type:"POST",contentType:"application/json"});return await async function(){return new Promise((o=>setTimeout(o,2e3)))}(),n}catch(o){console.log(o)}}(t),s=0}_()}));let d=null;function _(){if(d&&(clearInterval(d),d=null),n+=1,n>=t.length)return $("#main_box_experiment").hide(),$("#reward_box").show(),void $("#main_box_end").show();i=t[n],console.log(i);let o=document.getElementById("mime_video");o&&o.setAttribute("src",i.s3_url),$("#user_prediction").removeAttr("disabled"),console.log(i.sample_id),console.log(i.s3_url),$("#user_prediction").val(""),$("#option1_span").html(i.options[0]),$("#option2_span").html(i.options[1]),$("#option3_span").html(i.options[2]),$("#option4_span").html(i.options[3]),$("#mime_video").show(),$("#watchvideo_instruction").show(),$("#answer_box").hide();for(let o=1;o<=4;o++)$(`#button_option${o}`).removeAttr("activedecision"),$(`#button_option${o}`).removeAttr("disabled");$("#mcq_box").hide(),$("#button_next").hide(),$("#button_submit").hide(),$("#button_quit").hide(),$("#progress").text(`Progress: ${n+1} / ${t.length}`)}document.onvisibilitychange=()=>{document.hidden?(console.log("Window lost focus."),null!==d&&(clearInterval(d),d=null)):console.log("Window regained focus.")};const g=new URLSearchParams(window.location.search),b=g.get("start");g.get("uid"),globalThis.url_data=function(o){const t={};for(const[n,i]of o)t[n]=i;return t}(g.entries()),globalThis.avatar=g.get("avatar"),null==globalThis.avatar&&(globalThis.avatar="man"),globalThis.angle=g.get("angle"),null==globalThis.angle&&(globalThis.angle="0"),globalThis.background=g.get("background"),null==globalThis.background&&(globalThis.background="blank"),globalThis.annotator=g.get("annotator"),null==globalThis.annotator&&(globalThis.annotator="none"),globalThis.set=g.get("set"),null==globalThis.set&&(globalThis.set="1"),globalThis.uid=`${globalThis.avatar}_avatar-${globalThis.angle}_angle-${globalThis.background}_background-set${globalThis.set}`,console.log("Running with annotator",globalThis.annotator),console.log("Running with avatar",globalThis.avatar),console.log("Running with angle",globalThis.angle),console.log("Running with background",globalThis.background),async function(){return await $.getJSON(`baked_queues/${globalThis.avatar}_avatar-${globalThis.angle}_angle-${globalThis.background}_background-set${globalThis.set}.json?t=${Date.now()}`)}().catch((o=>{console.log("Invalid params: ",globalThis.url_data),window.location.reload()})).then((o=>{t=o,null!=b&&(n=parseInt(b)-1,console.log("Starting from",n)),r(0),$("#main_box_instructions").show(),$("#instructions_and_decorations").hide()})),console.log("Starting session with annotator:",globalThis.annotator)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QXhCakMsV0FBV1EsWUFBcUJSLFdBQVdRLFVBQVksUUFDM0RSLFdBQVd5QyxJQUFNZCxFQUFVTSxJQUFJLE9BQ1QsTUFBbEJqQyxXQUFXeUMsTUFBZXpDLFdBQVd5QyxJQUFNLEtBQy9DekMsV0FBV0UsSUFBTSxHQUFHRixXQUFXc0MsaUJBQWlCdEMsV0FBV3VDLGVBQWV2QyxXQUFXd0MsNEJBQTRCeEMsV0FBV3lDLE1BbUI1SGhELFFBQVFDLElBQUkseUJBQTBCTSxXQUFXUSxXQUNqRGYsUUFBUUMsSUFBSSxzQkFBdUJNLFdBQVdzQyxRQUM5QzdDLFFBQVFDLElBQUkscUJBQXNCTSxXQUFXdUMsT0FDN0M5QyxRQUFRQyxJQUFJLDBCQUEyQk0sV0FBV3dDLFlEdFMzQ3pDLGlCQUtILGFBSG1CekIsRUFBRW9FLFFBQ2pCLGdCQUFnQjFDLFdBQVdzQyxpQkFBaUJ0QyxXQUFXdUMsZUFBZXZDLFdBQVd3Qyw0QkFBNEJ4QyxXQUFXeUMsY0FBY0UsS0FBS0MsUUFHbkosQ0NrU0FDLEdBQVlDLE9BQU9DLElBRWZ0RCxRQUFRQyxJQUFJLG1CQUFvQk0sV0FBV0MsVUFDM0M0QixPQUFPQyxTQUFTa0IsUUFBUSxJQUUxQkMsTUFBTUMsSUFDSnJGLEVBQU9xRixFQUNjLE1BQWpCbEIsSUFDQWxFLEVBQWFxRixTQUFTbkIsR0FBaUIsRUFDdkN2QyxRQUFRQyxJQUFJLGdCQUFpQjVCLElBR2pDTSxFQUFrQixHQUNsQkUsRUFBRSwwQkFBMEJHLE9BQzVCSCxFQUFFLGlDQUFpQ0ssTUFBTSxJQTRCN0NjLFFBQVFDLElBQUksbUNBQW9DTSxXQUFXUSxVIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vLy4vc3JjL2Nvbm5lY3Rvci50cyIsIndlYnBhY2s6Ly8vLi9zcmMvbWFpbi50cyIsIndlYnBhY2s6Ly8vLi9zcmMvdXRpbHMudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgREVWTU9ERSB9IGZyb20gJy4vZ2xvYmFscydcbmltcG9ydCB7IE1PQ0tNT0RFIH0gZnJvbSAnLi9tYWluJ1xuXG5sZXQgU0VSVkVSX0xPR19ST09UID0gREVWTU9ERSA/IFwiaHR0cDovLzEyNy4wLjAuMTo1MDAwL1wiIDogXCJodHRwczovL3RlamFzc3Jpbml2YXNhbi5weXRob25hbnl3aGVyZS5jb20vXCJcblxuYXN5bmMgZnVuY3Rpb24gc2xlZXAobXM6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCBtcykpO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9hZF9kYXRhKCk6IFByb21pc2U8YW55PiB7XG4gICAgLy8gaW5jbHVkZSB0aW1lc3RhbXAgc28gdGhhdCB0aGluZ3MgZG9uJ3QgZ2V0IGNhY2hlZFxuICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmdldEpTT04oXG4gICAgICAgIGBiYWtlZF9xdWV1ZXMvJHtnbG9iYWxUaGlzLmF2YXRhcn1fYXZhdGFyLSR7Z2xvYmFsVGhpcy5hbmdsZX1fYW5nbGUtJHtnbG9iYWxUaGlzLmJhY2tncm91bmR9X2JhY2tncm91bmQtc2V0JHtnbG9iYWxUaGlzLnNldH0uanNvbj90PSR7RGF0ZS5ub3coKX1gLFxuICAgIClcbiAgICByZXR1cm4gcmVzdWx0XG59XG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nX2RhdGEoZGF0YSk6IFByb21pc2U8YW55PiB7XG4gICAgLy9pZiAoTU9DS01PREUpIHtcbiAgICAvLyAgICBjb25zb2xlLmxvZyhcImxvZ2dlZCAobW9jaylcIiwgZGF0YSlcbiAgICAvLyAgICByZXR1cm5cbiAgICAvL31cbiAgICBcbiAgICBkYXRhW1widXJsX2RhdGFcIl0gPSBnbG9iYWxUaGlzLnVybF9kYXRhXG4gICAgY29uc29sZS5sb2coXCJEYXRhXCIpXG4gICAgaWYgKCEoXCJzdHVkeV9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzdHVkeV9pZFwiXSA9IFwiZGVtb19zdHVkeVwiXG4gICAgfVxuICAgIGlmICghKFwicHJvbGlmaWNfaWRcIiBpbiBkYXRhWyd1cmxfZGF0YSddKSkge1xuICAgICAgICBkYXRhWyd1cmxfZGF0YSddW1wicHJvbGlmaWNfaWRcIl0gPSBcImRlbW9fdXNlclwiXG4gICAgfVxuICAgIGlmICghKFwic2Vzc2lvbl9pZFwiIGluIGRhdGFbJ3VybF9kYXRhJ10pKSB7XG4gICAgICAgIGRhdGFbJ3VybF9kYXRhJ11bXCJzZXNzaW9uX2lkXCJdID0gXCJkZW1vX3Nlc3Npb25cIlxuICAgIH1cbiAgICBkYXRhW1widXJsX2RhdGFcIl1bXCJxdWV1ZV9pZFwiXSA9IGdsb2JhbFRoaXMudWlkXG4gICAgY29uc29sZS5sb2coXCJsb2dnZWRcIiwgZGF0YSlcbiAgICBjb25zb2xlLmxvZyhcIkxvZ2dpbmcgdG9cIiwgU0VSVkVSX0xPR19ST09UICsgXCJsb2dcIilcblxuICAgIHRyeSB7XG4gICAgICAgIGxldCByZXN1bHQgPSBhd2FpdCAkLmFqYXgoXG4gICAgICAgICAgICBTRVJWRVJfTE9HX1JPT1QgKyBcImxvZ1wiLFxuICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgcHJvamVjdDogXCJtaW1lLWV2YWwtc3R1ZHkvaHVtYW4tZXZhbC9cIixcbiAgICAgICAgICAgICAgICAgICAgdWlkOiBnbG9iYWxUaGlzLnVpZCArIFwiX1wiICsgZ2xvYmFsVGhpcy5hbm5vdGF0b3IsXG4gICAgICAgICAgICAgICAgICAgIHBheWxvYWQ6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgICAgIHR5cGU6ICdQT1NUJyxcbiAgICAgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuICAgICAgICAgICAgfVxuICAgICAgICApXG4gICAgICAgIGF3YWl0IHNsZWVwKDIwMDApO1xuICAgICAgICByZXR1cm4gcmVzdWx0XG4gICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZyhlKVxuICAgIH1cbn0iLCJpbXBvcnQgeyBERVZNT0RFLCBSRVdBUkRfQ09SUkVDVCwgUEVOQUxUWV9JTkNPUlJFQ1QsIEVOQUJMRV9USU1FUiB9IGZyb20gXCIuL2dsb2JhbHNcIlxuZXhwb3J0IHZhciBVSUQ6IHN0cmluZ1xuZXhwb3J0IHZhciBNT0NLTU9ERTogYm9vbGVhbiA9IGZhbHNlXG5pbXBvcnQgeyBsb2FkX2RhdGEsIGxvZ19kYXRhIH0gZnJvbSAnLi9jb25uZWN0b3InXG5pbXBvcnQgeyBwYXJhbXNUb09iamVjdCB9IGZyb20gXCIuL3V0aWxzXCJcblxudmFyIGRhdGE6IGFueVtdID0gW11cbmxldCBxdWVzdGlvbl9pID0gLTFcbmxldCBxdWVzdGlvbjogYW55ID0gbnVsbFxuXG5cbmxldCBiYWxhbmNlID0gMFxuXG5sZXQgdXNlcl9tY3Ffc2VsZWN0aW9uID0gLTFcbmxldCB1c2VyX2lzX2NvcnJlY3QgPSBmYWxzZVxuXG5sZXQgaW5zdHJ1Y3Rpb25faTogbnVtYmVyID0gMFxubGV0IGNvdW50X2V4aXRlZF9wYWdlOiBudW1iZXIgPSAwXG5cbmZ1bmN0aW9uIGFzc2VydChjb25kaXRpb24sIG1lc3NhZ2UpIHtcbiAgICBpZiAoIWNvbmRpdGlvbikge1xuICAgICAgICB0aHJvdyBtZXNzYWdlIHx8IFwiQXNzZXJ0aW9uIGZhaWxlZFwiO1xuICAgIH1cbn1cblxuXG5mdW5jdGlvbiBuZXh0X2luc3RydWN0aW9ucyhpbmNyZW1lbnQ6IG51bWJlcikge1xuICAgIGluc3RydWN0aW9uX2kgKz0gaW5jcmVtZW50XG5cbiAgICBpZiAoaW5zdHJ1Y3Rpb25faSA9PSAwKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICB9IGVsc2Uge1xuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfcHJldlwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcbiAgICB9XG4gICAgaWYgKGluc3RydWN0aW9uX2kgPT0gMCkge1xuICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuc2hvdygpXG4gICAgICAgICQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19uZXh0XCIpLnZhbChcIlN0YXJ0IHN0dWR5XCIpXG4gICAgfSBlbHNlIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxuICAgICAgICAkKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS52YWwoXCJOZXh0XCIpXG4gICAgfVxuICAgIGlmIChpbnN0cnVjdGlvbl9pID09IDEpIHtcbiAgICAgICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLnNob3coKVxuICAgICAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5oaWRlKClcbiAgICAgICAgJChcIiNtYWluX2JveF9leHBlcmltZW50XCIpLnNob3coKVxuICAgICAgICBuZXh0X3F1ZXN0aW9uKClcbiAgICB9XG5cbiAgICAkKFwiI21haW5fYm94X2luc3RydWN0aW9uc1wiKS5jaGlsZHJlbihcIjpub3QoaW5wdXQpXCIpLmVhY2goKF8sIGVsKSA9PiB7XG4gICAgICAgICQoZWwpLmhpZGUoKVxuICAgIH0pXG4gICAgJChgI2luc3RydWN0aW9uc18ke2luc3RydWN0aW9uX2l9YCkuc2hvdygpXG59XG4kKFwiI2J1dHRvbl9pbnN0cnVjdGlvbnNfbmV4dFwiKS5vbihcImNsaWNrXCIsICgpID0+IG5leHRfaW5zdHJ1Y3Rpb25zKCsxKSlcbiQoXCIjYnV0dG9uX2luc3RydWN0aW9uc19wcmV2XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gbmV4dF9pbnN0cnVjdGlvbnMoLTEpKVxuXG4vLyBBZGQgbGlzdGVuZXIgdG8gZW5zdXJlIHRoZSB2aWRlbyBoYXMgYmVlbiB3YXRjaGVkXG5jb25zdCB2aWRlb0VsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWltZV92aWRlbycpO1xuXG5pZiAodmlkZW9FbGVtZW50KSB7XG4gICAgLy8gQWRkIGFuIGV2ZW50IGxpc3RlbmVyIGZvciB0aGUgJ2VuZGVkJyBldmVudFxuICAgIHZpZGVvRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCdlbmRlZCcsICgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ1RoZSB1c2VyIGhhcyB3YXRjaGVkIHRoZSBmdWxsIHZpZGVvLicpO1xuICAgICAgICAvLyBZb3UgY2FuIGFkZCBhZGRpdGlvbmFsIGFjdGlvbnMgaGVyZSwgc3VjaCBhcyBtYXJraW5nIHRoZSB2aWRlbyBhcyB3YXRjaGVkXG4gICAgICAgICQoXCIjd2F0Y2h2aWRlb19pbnN0cnVjdGlvblwiKS5oaWRlKClcbiAgICAgICAgLy8kKFwiI3VzZXJfcHJlZGljdGlvblwiKS52YWwoXCJcIilcbiAgICAgICAgJChcIiNhbnN3ZXJfYm94XCIpLnNob3coKVxuICAgIH0pO1xufSBlbHNlIHtcbiAgICBjb25zb2xlLmVycm9yKCdWaWRlbyBlbGVtZW50IHdpdGggSUQgXCJtaW1lX3ZpZGVvXCIgbm90IGZvdW5kLicpO1xufVxuXG5cbiQoJyNhbnN3ZXJfYm94Jykub24oJ2tleXVwJywgKCkgPT4ge1xuICAgIGxldCB1c2VyX3ByZWRpY3Rpb24gPSBTdHJpbmcoJCgnI3VzZXJfcHJlZGljdGlvbicpLnZhbCgpKS50cmltKClcbiAgICBpZiAodXNlcl9wcmVkaWN0aW9uICE9ICcnKSB7XG4gICAgICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5zaG93KClcbiAgICB9IGVsc2Uge1xuICAgICAgICBjb25zb2xlLmxvZygnVGhlIHRleHQgYm94IGlzIGVtcHR5LicpO1xuICAgICAgICAkKFwiI2J1dHRvbl9zdWJtaXRcIikuaGlkZSgpXG4gICAgfVxufSk7XG5cbiQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5vbihcImNsaWNrXCIsICgpID0+IHtcbiAgICAkKFwiI2J1dHRvbl9zdWJtaXRcIikuaGlkZSgpXG4gICAgJChcIiNtY3FfYm94XCIpLnNob3coKVxuICAgIC8vIERpc2FibGUgdGhlIHRleHQgYm94XG4gICAgJChcIiN1c2VyX3ByZWRpY3Rpb25cIikuYXR0cihcImRpc2FibGVkXCIsIFwidHJ1ZVwiKVxufSk7XG5cbmZ1bmN0aW9uIHJlZ2lzdGVyX21jcV9zZWxlY3Rpb24ob3B0aW9uKSB7XG4gICAgdXNlcl9tY3Ffc2VsZWN0aW9uID0gb3B0aW9uXG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gNDsgaSsrKSB7XG4gICAgICAgICQoYCNidXR0b25fb3B0aW9uJHtpfWApLmF0dHIoXCJkaXNhYmxlZFwiLCBcInRydWVcIilcbiAgICB9XG4gICAgJChgI2J1dHRvbl9vcHRpb24ke29wdGlvbn1gKS5hdHRyKFwiYWN0aXZlZGVjaXNpb25cIiwgXCJ0cnVlXCIpXG4gICAgdXNlcl9pc19jb3JyZWN0ID0gKHVzZXJfbWNxX3NlbGVjdGlvbiA9PSBxdWVzdGlvblsnbGFiZWxfaWR4J10rMSkgPyB0cnVlIDogZmFsc2VcblxuICAgICQoXCIjYnV0dG9uX25leHRcIikuc2hvdygpXG59XG4kKFwiI2J1dHRvbl9vcHRpb24xXCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gcmVnaXN0ZXJfbWNxX3NlbGVjdGlvbigxKSlcbiQoXCIjYnV0dG9uX29wdGlvbjJcIikub24oXCJjbGlja1wiLCAoKSA9PiByZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uKDIpKVxuJChcIiNidXR0b25fb3B0aW9uM1wiKS5vbihcImNsaWNrXCIsICgpID0+IHJlZ2lzdGVyX21jcV9zZWxlY3Rpb24oMykpXG4kKFwiI2J1dHRvbl9vcHRpb240XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4gcmVnaXN0ZXJfbWNxX3NlbGVjdGlvbig0KSlcblxuXG4kKFwiI2J1dHRvbl9uZXh0XCIpLm9uKFwiY2xpY2tcIiwgKCkgPT4ge1xuXG4gICAgLy8gVXBkYXRlIHRoZSB1c2VyIGJhbGFuY2VcbiAgICBpZiAocXVlc3Rpb25faSAhPSAtMSkge1xuICAgICAgICBsZXQgbG9nZ2VkX2RhdGEgPSB7XG4gICAgICAgICAgICBcInF1ZXN0aW9uX2lcIjogcXVlc3Rpb25faSxcbiAgICAgICAgICAgIFwic2FtcGxlX2lkXCI6IHF1ZXN0aW9uWydzYW1wbGVfaWQnXSxcbiAgICAgICAgICAgIFwidXNlcl9hbnN3ZXJcIjogJChcIiN1c2VyX3ByZWRpY3Rpb25cIikudmFsKCksXG4gICAgICAgICAgICBcInVzZXJfbWNxX3NlbGVjdGlvblwiOiB1c2VyX21jcV9zZWxlY3Rpb24sXG4gICAgICAgICAgICBcInVzZXJfaXNfY29ycmVjdFwiOiB1c2VyX2lzX2NvcnJlY3QsXG4gICAgICAgIH1cbiAgICAgICAgbG9nZ2VkX2RhdGFbJ3F1ZXN0aW9uJ10gPSBxdWVzdGlvblxuICAgICAgICBsb2dnZWRfZGF0YVsnY291bnRfZXhpdGVkX3BhZ2UnXSA9IGNvdW50X2V4aXRlZF9wYWdlXG4gICAgICAgIGxvZ19kYXRhKGxvZ2dlZF9kYXRhKVxuICAgICAgICBjb3VudF9leGl0ZWRfcGFnZSA9IDBcbiAgICB9XG4gICAgXG5cbiAgICBuZXh0X3F1ZXN0aW9uKClcbn0pO1xuXG5cbmxldCBhY3RpdmVUaW1lcjogUmV0dXJuVHlwZTx0eXBlb2Ygc2V0SW50ZXJ2YWw+IHwgbnVsbCA9IG51bGw7IC8vIFRpbWVyIGludGVydmFsXG5cbmZ1bmN0aW9uIHN0YXJ0VGltZXIoZHVyYXRpb24sIHN0ZXBEaXYsIGJ1dHRvbnMsIGNhbGxiYWNrKSB7XG4gICAgaWYgKCFFTkFCTEVfVElNRVIpIHtcbiAgICAgICAgLy8gSWYgdGhlIHRpbWVyIGlzIGRpc2FibGVkLCBlbmFibGUgdGhlIGJ1dHRvbnMgaW1tZWRpYXRlbHlcbiAgICAgICAgYnV0dG9ucy5mb3JFYWNoKGJ1dHRvbiA9PiBidXR0b24ucmVtb3ZlQXR0cmlidXRlKFwiZGlzYWJsZWRcIikpO1xuICAgICAgICBpZiAoY2FsbGJhY2spIGNhbGxiYWNrKCk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICAvLyBDbGVhciBhbnkgZXhpc3RpbmcgdGltZXIgdG8gcHJldmVudCBtdWx0aXBsZSBpbnRlcnZhbHNcbiAgICBpZiAoYWN0aXZlVGltZXIpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7XG4gICAgICAgIGFjdGl2ZVRpbWVyID0gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBEaXNhYmxlIGJ1dHRvbnNcbiAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5zZXRBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiLCBcInRydWVcIikpO1xuICAgIFxuICAgIC8vIFNob3cgdGltZXIgdmlzdWFsbHlcbiAgICBsZXQgdGltZXJEaXNwbGF5ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgdGltZXJEaXNwbGF5LmlkID0gYHRpbWVyXyR7c3RlcERpdi5pZH1gO1xuICAgIHRpbWVyRGlzcGxheS5zdHlsZS5mb250V2VpZ2h0ID0gJ2JvbGQnO1xuICAgIHRpbWVyRGlzcGxheS5zdHlsZS5tYXJnaW5Ub3AgPSAnMTBweCc7XG4gICAgc3RlcERpdi5hcHBlbmRDaGlsZCh0aW1lckRpc3BsYXkpO1xuXG4gICAgbGV0IHJlbWFpbmluZ1RpbWUgPSBkdXJhdGlvbjtcblxuICAgIC8vIEluaXRpYWwgZGlzcGxheVxuICAgIHRpbWVyRGlzcGxheS50ZXh0Q29udGVudCA9IGBQbGVhc2Ugd2FpdCAke3JlbWFpbmluZ1RpbWV9IHNlY29uZChzKSBiZWZvcmUgbWFraW5nIHlvdXIgc2VsZWN0aW9uLmA7XG5cbiAgICBhY3RpdmVUaW1lciA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgICAgcmVtYWluaW5nVGltZS0tO1xuICAgICAgICBpZiAocmVtYWluaW5nVGltZSA+PSAwKSB7XG4gICAgICAgICAgICB0aW1lckRpc3BsYXkudGV4dENvbnRlbnQgPSBgUGxlYXNlIHdhaXQgJHtyZW1haW5pbmdUaW1lfSBzZWNvbmQocykgYmVmb3JlIG1ha2luZyB5b3VyIHNlbGVjdGlvbi5gO1xuICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICBpZiAoYWN0aXZlVGltZXIgIT09IG51bGwpIHtcbiAgICAgICAgICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTsgLy8gU3RvcCB0aGUgdGltZXJcbiAgICAgICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBhY3RpdmVUaW1lciA9IG51bGw7XG5cbiAgICAgICAgICAgIC8vIFJlbW92ZSB0aW1lciBkaXNwbGF5XG4gICAgICAgICAgICBzdGVwRGl2LnJlbW92ZUNoaWxkKHRpbWVyRGlzcGxheSk7XG5cbiAgICAgICAgICAgIC8vIEVuYWJsZSBidXR0b25zXG4gICAgICAgICAgICBidXR0b25zLmZvckVhY2goYnV0dG9uID0+IGJ1dHRvbi5yZW1vdmVBdHRyaWJ1dGUoXCJkaXNhYmxlZFwiKSk7XG5cbiAgICAgICAgICAgIGlmIChjYWxsYmFjaykgY2FsbGJhY2soKTtcbiAgICAgICAgfVxuICAgIH0sIDEwMDApO1xufVxuXG4vLyBXaGVuIHRoZSB1c2VyIHN3aXRjaGVzIHRhYnMgb3IgbWluaW1pemVzIHRoZSB3aW5kb3csIHBhdXNlIHRoZSB0aW1lclxuZG9jdW1lbnQub252aXNpYmlsaXR5Y2hhbmdlID0gKCkgPT4ge1xuICAgIGlmIChkb2N1bWVudC5oaWRkZW4pIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJXaW5kb3cgbG9zdCBmb2N1cy5cIik7XG4gICAgICAgIGlmIChhY3RpdmVUaW1lciAhPT0gbnVsbCkge1xuICAgICAgICAgICAgY2xlYXJJbnRlcnZhbChhY3RpdmVUaW1lcik7IC8vIFBhdXNlIHRoZSB0aW1lclxuICAgICAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgICAgLy8gSGFuZGxlIGxvZ2ljIHdoZW4gdGhlIHVzZXIgcmV0dXJuc1xuICAgICAgICBjb25zb2xlLmxvZyhcIldpbmRvdyByZWdhaW5lZCBmb2N1cy5cIik7XG4gICAgfVxufTtcblxuXG5cbmZ1bmN0aW9uIG5leHRfcXVlc3Rpb24oKSB7XG4gICAgLy8gUmVzZXQgdGltZXJzIGFuZCBzdGF0ZVxuICAgIGlmIChhY3RpdmVUaW1lcikge1xuICAgICAgICBjbGVhckludGVydmFsKGFjdGl2ZVRpbWVyKTtcbiAgICAgICAgYWN0aXZlVGltZXIgPSBudWxsO1xuICAgIH1cblxuICAgIC8vIHJlc3RvcmUgcHJldmlvdXMgc3RhdGUgb2YgVUlcblxuICAgIC8vJChcIiNyYW5nZV92YWxcIikudmFsKHVzZXJfdHJ1c3QpXG5cbiAgICBxdWVzdGlvbl9pICs9IDFcbiAgICBpZiAocXVlc3Rpb25faSA+PSBkYXRhLmxlbmd0aCkge1xuICAgICAgICAkKFwiI21haW5fYm94X2V4cGVyaW1lbnRcIikuaGlkZSgpXG4gICAgICAgICQoJyNyZXdhcmRfYm94Jykuc2hvdygpXG4gICAgICAgICQoXCIjbWFpbl9ib3hfZW5kXCIpLnNob3coKVxuICAgICAgICByZXR1cm5cbiAgICB9XG5cbiAgICBxdWVzdGlvbiA9IGRhdGFbcXVlc3Rpb25faV1cbiAgICBjb25zb2xlLmxvZyhxdWVzdGlvbilcblxuICAgIGxldCB2aWRlb09iamVjdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwibWltZV92aWRlb1wiKVxuICAgIGlmICh2aWRlb09iamVjdCkge1xuICAgICAgICB2aWRlb09iamVjdC5zZXRBdHRyaWJ1dGUoXCJzcmNcIiwgcXVlc3Rpb25bJ3MzX3VybCddKVxuICAgIH1cbiAgICAkKFwiI3VzZXJfcHJlZGljdGlvblwiKS5yZW1vdmVBdHRyKFwiZGlzYWJsZWRcIilcblxuICAgIGNvbnNvbGUubG9nKHF1ZXN0aW9uWydzYW1wbGVfaWQnXSlcbiAgICBjb25zb2xlLmxvZyhxdWVzdGlvblsnczNfdXJsJ10pXG4gICAgJChcIiN1c2VyX3ByZWRpY3Rpb25cIikudmFsKFwiXCIpXG4gICAgJChcIiNvcHRpb24xX3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJvcHRpb25zXCJdWzBdKVxuICAgICQoXCIjb3B0aW9uMl9zcGFuXCIpLmh0bWwocXVlc3Rpb24hW1wib3B0aW9uc1wiXVsxXSlcbiAgICAkKFwiI29wdGlvbjNfc3BhblwiKS5odG1sKHF1ZXN0aW9uIVtcIm9wdGlvbnNcIl1bMl0pXG4gICAgJChcIiNvcHRpb240X3NwYW5cIikuaHRtbChxdWVzdGlvbiFbXCJvcHRpb25zXCJdWzNdKVxuXG4gICAgJChcIiNtaW1lX3ZpZGVvXCIpLnNob3coKVxuICAgICQoXCIjd2F0Y2h2aWRlb19pbnN0cnVjdGlvblwiKS5zaG93KClcbiAgICAkKCcjYW5zd2VyX2JveCcpLmhpZGUoKVxuICAgIGZvciAobGV0IGkgPSAxOyBpIDw9IDQ7IGkrKykge1xuICAgICAgICAkKGAjYnV0dG9uX29wdGlvbiR7aX1gKS5yZW1vdmVBdHRyKFwiYWN0aXZlZGVjaXNpb25cIilcbiAgICAgICAgJChgI2J1dHRvbl9vcHRpb24ke2l9YCkucmVtb3ZlQXR0cihcImRpc2FibGVkXCIpXG4gICAgfVxuICAgICQoXCIjbWNxX2JveFwiKS5oaWRlKClcbiAgICAkKFwiI2J1dHRvbl9uZXh0XCIpLmhpZGUoKVxuICAgICQoXCIjYnV0dG9uX3N1Ym1pdFwiKS5oaWRlKClcbiAgICAkKCcjYnV0dG9uX3F1aXQnKS5oaWRlKClcblxuXG4gICAgLy8gc2V0IGJldCB2YWx1ZSByYXRpb1xuICAgIC8vaWYocXVlc3Rpb24uaGFzT3duUHJvcGVydHkoXCJyZXdhcmRfcmF0aW9cIikpIHtcbiAgICAvLyAgICBsZXQgW3JhdGlvMSwgcmF0aW8yXSA9IHF1ZXN0aW9uW1wicmV3YXJkX3JhdGlvXCJdXG4gICAgLy8gICAgcmF0aW8xID0gTnVtYmVyKHJhdGlvMSlcbiAgICAvLyAgICByYXRpbzIgPSBOdW1iZXIocmF0aW8yKVxuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSByYXRpbzEvcmF0aW8yXG4gICAgLy99IGVsc2Uge1xuICAgIC8vICAgIGJldF92YWxfcmF0aW8gPSAxXG4gICAgLy99XG5cbiAgICAvL3RpbWVfcXVlc3Rpb25fc3RhcnQgPSBEYXRlLm5vdygpXG4gICAgJChcIiNwcm9ncmVzc1wiKS50ZXh0KGBQcm9ncmVzczogJHtxdWVzdGlvbl9pICsgMX0gLyAke2RhdGEubGVuZ3RofWApXG5cbn1cblxuXG5cbi8vIGdldCB1c2VyIGlkIGFuZCBsb2FkIHF1ZXVlXG4vLyB0cnkgdG8gc2VlIGlmIHN0YXJ0IG92ZXJyaWRlIHdhcyBwYXNzZWRcbmNvbnN0IHVybFBhcmFtcyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7XG5jb25zdCBzdGFydE92ZXJyaWRlID0gdXJsUGFyYW1zLmdldCgnc3RhcnQnKTtcbmNvbnN0IFVJREZyb21VUkwgPSB1cmxQYXJhbXMuZ2V0KFwidWlkXCIpXG5nbG9iYWxUaGlzLnVybF9kYXRhID0gcGFyYW1zVG9PYmplY3QodXJsUGFyYW1zLmVudHJpZXMoKSlcblxuZ2xvYmFsVGhpcy5hdmF0YXIgPSB1cmxQYXJhbXMuZ2V0KFwiYXZhdGFyXCIpXG5pZiAoZ2xvYmFsVGhpcy5hdmF0YXIgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmF2YXRhciA9IFwibWFuXCIgfVxuZ2xvYmFsVGhpcy5hbmdsZSA9IHVybFBhcmFtcy5nZXQoXCJhbmdsZVwiKVxuaWYgKGdsb2JhbFRoaXMuYW5nbGUgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmFuZ2xlID0gXCIwXCIgfVxuZ2xvYmFsVGhpcy5iYWNrZ3JvdW5kID0gdXJsUGFyYW1zLmdldChcImJhY2tncm91bmRcIilcbmlmIChnbG9iYWxUaGlzLmJhY2tncm91bmQgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmJhY2tncm91bmQgPSBcImJsYW5rXCIgfVxuZ2xvYmFsVGhpcy5hbm5vdGF0b3IgPSB1cmxQYXJhbXMuZ2V0KFwiYW5ub3RhdG9yXCIpXG5pZiAoZ2xvYmFsVGhpcy5hbm5vdGF0b3IgPT0gbnVsbCkgeyBnbG9iYWxUaGlzLmFubm90YXRvciA9IFwibm9uZVwiIH1cbmdsb2JhbFRoaXMuc2V0ID0gdXJsUGFyYW1zLmdldChcInNldFwiKVxuaWYgKGdsb2JhbFRoaXMuc2V0ID09IG51bGwpIHsgZ2xvYmFsVGhpcy5zZXQgPSBcIjFcIiB9XG5nbG9iYWxUaGlzLnVpZCA9IGAke2dsb2JhbFRoaXMuYXZhdGFyfV9hdmF0YXItJHtnbG9iYWxUaGlzLmFuZ2xlfV9hbmdsZS0ke2dsb2JhbFRoaXMuYmFja2dyb3VuZH1fYmFja2dyb3VuZC1zZXQke2dsb2JhbFRoaXMuc2V0fWBcblxuLy9pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsnc3R1ZHlfaWQnXSA9PSBudWxsKSB7XG4vLyAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydzdHVkeV9pZCddID0gXCJkZW1vX3N0dWR5XCJcbi8vfVxuLy9pZiAoZ2xvYmFsVGhpcy51cmxfZGF0YVsncHJvbGlmaWNfaWQnXSA9PSBudWxsKSB7XG4vLyAgICBnbG9iYWxUaGlzLnVybF9kYXRhWydwcm9saWZpY19pZCddID0gXCJkZW1vX3VzZXJcIlxuLy99XG4vL2lmIChnbG9iYWxUaGlzLnVybF9kYXRhWydzZXNzaW9uX2lkJ10gPT0gbnVsbCkge1xuLy8gICAgZ2xvYmFsVGhpcy51cmxfZGF0YVsnc2Vzc2lvbl9pZCddID0gXCJkZW1vX3Nlc3Npb25cIlxuLy99XG5cbi8vIHZlcnNpb24gZm9yIHBhcGVyXG5pZiAoREVWTU9ERSkge1xuICAgIE1PQ0tNT0RFID0gdHJ1ZVxufSBlbHNlIHtcbiAgICBNT0NLTU9ERSA9IHRydWVcbn1cblxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYW5ub3RhdG9yXCIsIGdsb2JhbFRoaXMuYW5ub3RhdG9yKVxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYXZhdGFyXCIsIGdsb2JhbFRoaXMuYXZhdGFyKVxuY29uc29sZS5sb2coXCJSdW5uaW5nIHdpdGggYW5nbGVcIiwgZ2xvYmFsVGhpcy5hbmdsZSlcbmNvbnNvbGUubG9nKFwiUnVubmluZyB3aXRoIGJhY2tncm91bmRcIiwgZ2xvYmFsVGhpcy5iYWNrZ3JvdW5kKVxuXG5sb2FkX2RhdGEoKS5jYXRjaCgoX2Vycm9yKSA9PiB7XG4gICAgLy9hbGVydChcIkludmFsaWQgdXNlciBpZC5cIilcbiAgICBjb25zb2xlLmxvZyhcIkludmFsaWQgcGFyYW1zOiBcIiwgZ2xvYmFsVGhpcy51cmxfZGF0YSlcbiAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKClcbn1cbikudGhlbigobmV3X2RhdGEpID0+IHtcbiAgICBkYXRhID0gbmV3X2RhdGFcbiAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4gICAgICAgIHF1ZXN0aW9uX2kgPSBwYXJzZUludChzdGFydE92ZXJyaWRlKSAtIDFcbiAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpXG4gICAgfVxuICAgIC8vIG5leHRfcXVlc3Rpb24oKVxuICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApXG4gICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpXG4gICAgJChcIiNpbnN0cnVjdGlvbnNfYW5kX2RlY29yYXRpb25zXCIpLmhpZGUoKVxufSlcblxuLy8gLy8gRHluYW1pY2FsbHkgbG9hZCBkYXRhc2V0IGJhc2VkIG9uIERBVEFTRVRcbi8vIGZldGNoKGAuL2Jha2VkX3F1ZXVlcy8ke0RBVEFTRVR9YClcbi8vICAgICAudGhlbihyZXNwb25zZSA9PiB7XG4vLyAgICAgICAgIGlmICghcmVzcG9uc2Uub2spIHtcbi8vICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIkZhaWxlZCB0byBsb2FkIGRhdGFzZXQuXCIpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIHJldHVybiByZXNwb25zZS5qc29uKCk7XG4vLyAgICAgfSlcbi8vICAgICAudGhlbigobmV3X2RhdGEpID0+IHtcbi8vICAgICAgICAgZGF0YSA9IG5ld19kYXRhO1xuLy8gICAgICAgICBpZiAoc3RhcnRPdmVycmlkZSAhPSBudWxsKSB7XG4vLyAgICAgICAgICAgICBxdWVzdGlvbl9pID0gcGFyc2VJbnQoc3RhcnRPdmVycmlkZSkgLSAxO1xuLy8gICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdGFydGluZyBmcm9tXCIsIHF1ZXN0aW9uX2kpO1xuLy8gICAgICAgICB9XG4vLyAgICAgICAgIG5leHRfaW5zdHJ1Y3Rpb25zKDApO1xuLy8gICAgICAgICB1cGRhdGVSZXdhcmRJbnN0cnVjdGlvbnMoKTtcbi8vICAgICAgICAgJChcIiNtYWluX2JveF9pbnN0cnVjdGlvbnNcIikuc2hvdygpO1xuLy8gICAgICAgICAkKFwiI2luc3RydWN0aW9uc19hbmRfZGVjb3JhdGlvbnNcIikuaGlkZSgpO1xuLy8gICAgIH0pXG4vLyAgICAgLmNhdGNoKChfZXJyb3IpID0+IHtcbi8vICAgICAgICAgY29uc29sZS5lcnJvcihcIkludmFsaWQgdXNlciBpZCBvciBkYXRhc2V0IGxvYWRpbmcgZmFpbGVkLlwiKTtcbi8vICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuLy8gICAgIH0pO1xuXG5cbmNvbnNvbGUubG9nKFwiU3RhcnRpbmcgc2Vzc2lvbiB3aXRoIGFubm90YXRvcjpcIiwgZ2xvYmFsVGhpcy5hbm5vdGF0b3IpXG4iLCJmdW5jdGlvbiBwYXJhbXNUb09iamVjdChlbnRyaWVzKSB7XG4gIGNvbnN0IHJlc3VsdCA9IHt9XG4gIC8vIGVhY2ggJ2VudHJ5JyBpcyBhIFtrZXksIHZhbHVlXSB0dXBwbGVcbiAgZm9yIChjb25zdCBba2V5LCB2YWx1ZV0gb2YgZW50cmllcykge1xuICAgIHJlc3VsdFtrZXldID0gdmFsdWU7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IHsgcGFyYW1zVG9PYmplY3QgfSJdLCJuYW1lcyI6WyJTRVJWRVJfTE9HX1JPT1QiLCJkYXRhIiwicXVlc3Rpb25faSIsInF1ZXN0aW9uIiwidXNlcl9tY3Ffc2VsZWN0aW9uIiwidXNlcl9pc19jb3JyZWN0IiwiaW5zdHJ1Y3Rpb25faSIsImNvdW50X2V4aXRlZF9wYWdlIiwibmV4dF9pbnN0cnVjdGlvbnMiLCJpbmNyZW1lbnQiLCIkIiwiYXR0ciIsInJlbW92ZUF0dHIiLCJzaG93IiwidmFsIiwiaGlkZSIsIm5leHRfcXVlc3Rpb24iLCJjaGlsZHJlbiIsImVhY2giLCJfIiwiZWwiLCJvbiIsInZpZGVvRWxlbWVudCIsImRvY3VtZW50IiwiZ2V0RWxlbWVudEJ5SWQiLCJyZWdpc3Rlcl9tY3Ffc2VsZWN0aW9uIiwib3B0aW9uIiwiaSIsImFkZEV2ZW50TGlzdGVuZXIiLCJjb25zb2xlIiwibG9nIiwiZXJyb3IiLCJTdHJpbmciLCJ0cmltIiwibG9nZ2VkX2RhdGEiLCJhc3luYyIsImdsb2JhbFRoaXMiLCJ1cmxfZGF0YSIsInVpZCIsInJlc3VsdCIsImFqYXgiLCJKU09OIiwic3RyaW5naWZ5IiwicHJvamVjdCIsImFubm90YXRvciIsInBheWxvYWQiLCJ0eXBlIiwiY29udGVudFR5cGUiLCJQcm9taXNlIiwicmVzb2x2ZSIsInNldFRpbWVvdXQiLCJzbGVlcCIsImUiLCJsb2dfZGF0YSIsImFjdGl2ZVRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImxlbmd0aCIsInZpZGVvT2JqZWN0Iiwic2V0QXR0cmlidXRlIiwiaHRtbCIsInRleHQiLCJvbnZpc2liaWxpdHljaGFuZ2UiLCJoaWRkZW4iLCJ1cmxQYXJhbXMiLCJVUkxTZWFyY2hQYXJhbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInNlYXJjaCIsInN0YXJ0T3ZlcnJpZGUiLCJnZXQiLCJlbnRyaWVzIiwia2V5IiwidmFsdWUiLCJwYXJhbXNUb09iamVjdCIsImF2YXRhciIsImFuZ2xlIiwiYmFja2dyb3VuZCIsInNldCIsImdldEpTT04iLCJEYXRlIiwibm93IiwibG9hZF9kYXRhIiwiY2F0Y2giLCJfZXJyb3IiLCJyZWxvYWQiLCJ0aGVuIiwibmV3X2RhdGEiLCJwYXJzZUludCJdLCJzb3VyY2VSb290IjoiIn0=